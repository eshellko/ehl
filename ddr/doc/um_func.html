<html>
   <style> pre.small {line-height: 0.5; font-weight:bold; color: #FF00FF; }</style>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Функционирование</title>
   </head>
   <body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
      <div class="article">
         <div class="titlepage">
            <h2 class="title">Функционирование</h2>
         </div>
      </div>
      <p><b>ehl_ddr</b> предназначен для преобразования транзакций на шине AXI в транзакции на шине DFI (и далее через PHY в SDRAM). Контроллер имеет ряд управляющих и статусных регистров, определяющих процесс преобразования. В таблице приведен перечень программно управляемых регистров <b>ehl_ddr</b>.</p>
      <h2><a name="REGS"></a>Регистры контроллера</h2>
      <table summary="Registers for Address Block: ehl_ddr" cellpadding="4" width="0%" border="1" cellspacing="0" rules="all">
         <colgroup><col><col><col></colgroup>
         <thead>
            <tr bgcolor="#C0C0C0">
               <th>Регистр</th>
               <th>Адрес</th>
               <th>Описание</th>
            </tr>
         </thead>
         <tbody>
            <tr> <td><a href="reg_desc.html#ehl-DDR_MR0" class="olink">DDR_MR0</a></td>                     <td>0x0</td> <td>Регистр MR0 SDRAM</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_MR1" class="olink">DDR_MR1</a></td>                     <td>0x4</td> <td>Регистр MR1 SDRAM</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_MR2" class="olink">DDR_MR2</a></td>                     <td>0x8</td> <td>Регистр MR2 SDRAM</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_MR3" class="olink">DDR_MR3</a></td>                     <td>0xC</td> <td>Регистр MR3 SDRAM</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_TYPE" class="olink">DDR_TYPE</a></td>                   <td>0x10</td> <td>Регистр структуры памяти</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_TIME0" class="olink">DDR_TIME0</a></td>                 <td>0x14</td> <td>Регистр временных параметров 0</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_TIME1" class="olink">DDR_TIME1</a></td>                 <td>0x18</td> <td>Регистр временных параметров 1</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_ODT" class="olink">DDR_ODT</a></td>                     <td>0x1c</td> <td>Регистр маски ODT</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR2_CTRL" class="olink">DDR2_CTRL</a></td>                 <td>0x20</td> <td>Регистр управления SDRAM</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR3_CTRL" class="olink">DDR3_CTRL</a></td>                 <td>0x24</td> <td>Регистр управления функциями DDR3</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_PHY" class="olink">DDR_PHY</a></td>                     <td>0x28</td> <td>Регистр характеристик PHY</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_CMD" class="olink">DDR_CMD</a></td>                     <td>0x30</td> <td>Регистр команд SDRAM</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_ECC_FIFO_LSB" class="olink">DDR_ECC_FIFO_LSB</a></td>   <td>0x34</td> <td>Регистр адресов ошибок 1</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_ECC_FIFO_MSB" class="olink">DDR_ECC_FIFO_MSB</a></td>   <td>0x38</td> <td>Регистр адресов ошибок 2</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_EC" class="olink">DDR_EC</a></td>                       <td>0x3c</td> <td>Регистр обнаружения ошибок</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_ECC_SE_PAT0" class="olink">DDR_ECC_SE_PAT0</a></td>     <td>0x40</td> <td>Регистр диагностики одиночных ошибок 0</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_ECC_SE_PAT1" class="olink">DDR_ECC_SE_PAT1</a></td>     <td>0x44</td> <td>Регистр диагностики одиночных ошибок 1</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_ECC_SE_PAT2" class="olink">DDR_ECC_SE_PAT2</a></td>     <td>0x48</td> <td>Регистр диагностики одиночных ошибок 2</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR3_RESET" class="olink">DDR3_RESET</a></td>               <td>0x4c</td> <td>Регистр временной диаграммы сброса</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR3_ZQ" class="olink">DDR3_ZQ</a></td>                     <td>0x50</td> <td>Регистр периода ZQ калибровки</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-FPGA_CTRL" class="olink">FPGA_CTRL</a></td>                 <td>0x54</td> <td>Регистр управления UniPHY</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_BYTE0" class="olink">DDR_BYTE0</a></td>                 <td>0x58</td> <td>Регистр Byte 0 Status</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_BYTE1" class="olink">DDR_BYTE1</a></td>                 <td>0x5c</td> <td>Регистр Byte 1 Status</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_BYTE2" class="olink">DDR_BYTE2</a></td>                 <td>0x60</td> <td>Регистр Byte 2 Status</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_BYTE3" class="olink">DDR_BYTE3</a></td>                 <td>0x64</td> <td>Регистр Byte 3 Status</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_BYTE4" class="olink">DDR_BYTE4</a></td>                 <td>0x68</td> <td>Регистр Byte 4 Status</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_BYTE5" class="olink">DDR_BYTE5</a></td>                 <td>0x6c</td> <td>Регистр Byte 5 Status</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_BYTE6" class="olink">DDR_BYTE6</a></td>                 <td>0x70</td> <td>Регистр Byte 6 Status</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_BYTE7" class="olink">DDR_BYTE7</a></td>                 <td>0x74</td> <td>Регистр Byte 7 Status</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_BYTE8" class="olink">DDR_BYTE8</a></td>                 <td>0x78</td> <td>Регистр Byte 8 Status</td> </tr>
            <tr> <td><a href="reg_desc.html#ehl-DDR_CFG" class="olink">DDR_CFG</a></td>                     <td>0x7c</td> <td>Регистр конфигурации контроллера</td> </tr>
<!--
            <tr> <td><a href="ehl_ddr_phy.html#ehl-PHY_DLL_CTRL" class="olink">PHY_DLL_CTRL</a></td>        <td>0x80</td> <td>Регистр управления DLL PHY (является частью PHY)</td> </tr>
            <tr> <td><a href="ehl_ddr_phy.html#ehl-PHY_IO_CTRL" class="olink">PHY_IO_CTRL</a></td>          <td>0x84</td> <td>Регистр управления IO PHY (является частью PHY)</td> </tr>
-->
         </tbody>
      </table>
      <h2><a name="INIT"></a>Инициализация контроллера</h2>
      <p>Перед использованием контроллера его следует инициализировать. Инициализация включает в себя запись в регистры настроек, соответствующих реальным значениям тактовой частоты SDRAM, структур микросхем памяти и PHY, управляемых контроллером, процедуру инициализации SDRAM, тренинг положения маски строба, тренинг положения строба. Последовательность описана далее:</p>
      <p><b style="color: #FF0000">Замечание. </b>Процедура инициализации сторонних PHY (<b>PHY_TYPE</b> != 0) может отличаться. Требуется проконсультироваться с документацией на PHY.</p>
      <p><b>1.</b> Запуск таймера после подачи питания.</p>
      <p><b>2.</b> Выполнить инициализацию DLL в соответствии с описанием из раздела <a href="um_func.html#DLL_INIT" class="olink">"Изменение тактовой частоты"</a>.</p>
      <p><b>3.</b> Задать поддерживаемый протокол памяти в <b>DDR_CTRL.DM</b>. DDR2 в случае <b>PHY_TYPE</b>=0.</p>
      <p><b>4.</b> Запись в регистр <b>DDR_MR0</b> (Write Recovery, CAS Latency и Burst Length).</p>
      <p><b>5.</b> Запись в регистр <b>DDR_MR1</b> (Enable_DQSn, DLL Enable, Additive Latency и Termination Resistor).</p>
      <p><b>6.</b> Запись в регистр <b>DDR_MR2</b> (High-Temperature Self-Refresh).</p>
      <p><b>7.</b> Запись в регистр <b>DDR_TYPE</b> значений структуры памяти (раздел <a href="um_func.html#ADDRDEC" class="olink">"Кодирование адресов"</a>) и соответствие сигналов <b>dfi_cs_n</b> чипам памяти.</p>
      <p><b>8.</b> Запись в регистр <b>DDR_PHY</b> характеристик PHY.</p>
      <p><b>9.</b> Запись в регистр <b>DDR_ODT</b> параметров шумоподавляющих резисторов.</p>
      <p><b>10.</b> Запись в регистры <b>DDR_TIME0</b> и <b>DDR_TIME1</b> временных характеристик в соответствии с заданной тактовой частотой контроллера (частота задается независимо от <b>ehl_ddr</b>).</p>
      <p><b>11.</b> Дождаться, пока таймер отсчитает 200 мкс с момента подачи питания.</p>
      <p><b>12.</b> Запустить инициализацию установив <b>DDR_CMD.STI</b>. [A-5-2-0]</p>
      <p><b>13.</b> Дождаться окончания инициализации - сброс бита <b>DDR_CMD.STI</b>.</p>
      <p>Время инициализации DDR2 между установкой и сбросом <b>DDR_CMD.STI</b> может быть оценено по следующей формуле: 1 + <b>CDC_SYNC_STAGE</b> + 1 + 1 + (8+<b>tRP</b>) + 4*(1+<b>tMRD</b>) + (1+<b>tRP</b>) + 8*(1+<b>tRFC</b>)+3*(1+<b>tMRD</b>) + <b>CDC_SYNC_STAGE</b> + 1.</p>
      <p>Например, для частоты 400 МГц оно может составлять: 1+2+1+1+8+6+4*3+7+8*132+3*3+3 = 1106 тактов <b>mctrl_clk</b>.</p>
      <p><b>14.</b> Запись в регистр <b>DDR2_CTRL</b> разрешения периодического обновления памяти, номинала резисторов ODT.</p>
      <p><b>15.</b> Провести процедуру Gate Training установив бит <b>DDR_CMD.RGT</b>. Дождаться окончания выполнения процедуры отслеживая данный бит. Процедуру следует проводить с выключенным режимом коррекции ошибок <b>DDR_EC</b>.</p>
      <p><b>16.</b> Записать значение 0xFF-0x00 по адресу 0x0 на шине AXI контроллера (адрес может отличаться от 0x0, если контроллер имеет смещенный базовый адрес) с шириной данных равной ширине системной шины. Поскольку контроллер записывает данные в SDRAM порциями размером Burst Length, следует записать количество данных, соответствующих <b>DDR_MR0.BL</b>.Дождаться завершения транзакции по WRITE RESPONSE CHANNEL. В случае мультиранковых систем указанные данные следует размещать по адресу 0x0 для каждого ранка, присутствующего в системе.</p>
      <p><b>17.</b> Если контроллер поддерживает режим коррекции ошибок, то следует записать данные аналогично предыдущему пункту в режиме тестирования блока контрольных разрядов (<b>DDR_EC.mode</b> равен 0b10).</p>
      <p><b>18.</b> Режим коррекции следует отключить на время проведения процедуры Data Eye Training (<b>DDR_EC.mode</b> равен 0b00). Провести процедуру Data Eye Training установив бит <b>DDR_CMD.RDET</b>. Дождаться окончания выполнения процедуры отслеживая данный бит.</p>
      <p><b>19.</b> Если предполагается использование режима коррекции ошибок, то всю используемую область памяти следует инициализировать с включенным режимом коррекции ошибок для записи проверочного кода. Ширину транзакций AXI следует выбрать максимальной для системной шины (параметр <b>AXI_WIDTH</b>).</p>
      <p>Контроллер готов к использованию.</p>
      <h2><a name="ODT"></a>On-Die Termination (ODT) DDR2</h2>
      <p>Стандарт DDR2 определяет режим управления шумоподавляющими резисторами. Управляет резисторами контроллер памяти. Резисторы предназначены для улучшения целостности сигналов и сокращения количества внешних компонент на печатной плате.</p>
      <p><b>ehl_ddr</b> управляет резисторами памяти через вывод <b>dfi_odt</b> (<b>sdram_odt</b> PHY), если данная функция включена в <b>PHY_IO_CTRL.ODT</b> (при значении отличном от 0). Управление резисторами контактных площадок контроллера должно осуществляться в PHY. В режиме чтения из памяти PHY должен включать резисторы в контактных площадках синхронно с данными. В режиме записи PHY должен выключать резисторы в контактных площадках. В режиме чтения/записи контроллер включает резисторы неактивных чипов памяти, и отключает резисторы адресуемых чипов.</p>
      <p>Согласно [1] номинал резисторов для выводов DQ, DQS, DQS_n, DM памяти и контроллера (точнее контактных площадок) может иметь значения 50 Ом, 75 Ом, 150 Ом или бесконечность. Управление значением номинала контроллера осуществляется с помощью <b>PHY_IO_CTRL.ODT</b>. Значение регистра должно управлять номинальным сопротивлением контактных площадок через вывод odt <b>ehl_ddr</b>. Управление значением номинала резисторов в памяти осуществляется с помощью <b>DDR_MR1.TRL</b> и <b>DDR_MR1.TRH</b> и требует процедуры LOAD-MODE-REGISTER (<b>DDR_CMD.LMRA</b> = 1) для записи значения в память. </p>
      <p><b style="color: #FF0000">Замечание. </b>Номиналы резисторов PHY и памяти задаются независимо и могут отличаться.</p>
      <img src="um_odt_write.png"></a>
      <p>Рисунок 4. Запись в память с включенным режимом ODT</p>
      <img src="um_odt_read.png"></a>
      <p>Рисунок 5. Чтение из памяти с включенным режимом ODT</p>
      <p>Согласно [1] время включения резисторов составляет 2 такта <b>sdram_ck</b>, время выключения 2.5 такта <b>sdram_ck</b>. <b>ehl_ddr</b> включает резисторы таким образом, что шумоподавляющие резисторы активны на протяжении всего трансфера [A-5-3-0] (включение - красные линии на Рисунок 4/Рисунок 5, выключение - синие линии на Рисунок 4/Рисунок 5). В случае непрерывной передачи (несколько команд записи/чтения) <b>ehl_ddr</b> удерживает резисторы включенными на протяжении всего трансфера [A-5-3-1]. В случае, если трансфер требует обращения к двум чипам памяти, управляемым независимыми <b>sdram_odt</b>, контроллер добавляет цикл паузы между трансферами, чтобы обеспечить корректное включение/выключение резисторов (а также освобождение шин DQ/DQS/DM, которые управляются различными чипами памяти). [A-5-3-2]</p>
      <h2><a name="ODT"></a>On-Die Termination (ODT) DDR3</h2>
      <p>Стандарт DDR3 задает параметры ODTLon и ODTLoff, определяющие момент включения/выключения шумоподавляющих резисторов относительно сигнала ODT. Это время равняется CWL + AL - 2, т.е. эквиваленто Write Latency - 2 для чтения и записи. Данное условие приводит к тому, что ODT должен переключаться одновремено с командой записи, и через RL - WL тактов после команды чтения и оставаться активным на протяжении 4 (ODTH4) или 6 (ODTH8) тактов после этого в зависимости от Burst Length (BL4 и BL8 соответственно).</p>
      <h2><a name="TRNG"></a>Тренинги</h2>
<!--       <p><b style="color: #FF0000">TODO: </b> Дать пользователю возможность программировать адрес, используемый для тренинга? Поскольку адрес для тренинга в процессе работы может зависеть от [операционной] системы, управляющей контроллером.</p> -->
      <p><b style="color: #FF0000">Замечание. </b> Процедуры тренинга используются только для режимов DDR2 при использовании <b>ehl_ddr_phy</b>. Для других PHY логика тренингов встроена в состав PHY. Следует обратиться к документации на PHY для уточнения необходимой процедуры тренингов.</p>
      <p><b style="color: #FF0000">Замечание. </b> В мультиранковых системах (RANK_CNT > 1) возможно, что время прихода сигналов от различных ранков памяти при чтении отличается, поэтому тренинг следует проводить для каждого из присутствующих ранков путем использования <b>DDR2_CTRL.ERT</b>. При этом следует запрограммировать <b>DDR_TYPE.MC</b>x перед проведением тренингов, и учесть, что адрес для тренинга выбирается без учета измененных значений <b>DDR_TYPE.MC</b>x. Т.е. если чипы были переставлены с 0-1-2-3 в 0-1-3-2, то для проведения тренинга RANK3, следует установить <b>DDR2_CTRL.ERT</b>[2] и наоборот - для RANK2 - <b>DDR2_CTRL.ERT</b>[3].</p>
      <p>Для обеспечения корректного функционирования PHY должен быть инициализирован и настроен в соответствии с характеристиками системы памяти. Для проверки временных характеристик и адаптации к системе используются процедуры тренинга. При запросе проведения тренинга <b>ehl_ddr</b> переходит в один из двух режимом тренинга: тренинг положения маски стробов (Gate Training) или тренинг положения стробов (Data Eye Training). По окончании тренинга коэффициенты записываются в регистры <b>ehl_ddr</b>. Значения коэффициентов могут быть записаны через AHB без проведения тренингов. Коэффициенты рассчитываются независимо для каждого байта данных и проверочных бит SDRAM (параметры <b>SDRAM_WIDTH</b> и <b>ECC_ENA</b>). Последовательность запуска выполнения тренингов описана в разделе "<a href="um_func.html#INIT" class="olink">Инициализация контроллера</a>". Аппаратура для проведения тренингов находится в PHY. <b>ehl_ddr</b> инициирует тренинги и анализирует их результаты.</p>
      <h3 style="color: #0000CC">Тренинг положения маски стробов</h3>
      <p>Положение маски стробов [2, раздел 4.9.4.1.1  - gate training] <b>dfi_rddata_en</b> рассчитывается путем захвата сигнала <b>sdram_dqs</b> (подключенного к PHY) нарастающим фронтом <b>dfi_rddata_en</b>, задержанного в соответствии с заданным коэффициентом <b>dfi_rdlvl_gate_delay</b> (Рисунок 6). Расширение диапазона ожидания строба доступно с помощью старшего бита <b>dfi_rdlvl_gate_delay</b> (регистры <b>DDR_BYTEx.GTRy[3]</b>). Если соответствующие биты установлены PHY использует в качестве маски сигнал <b>dfi_rddata_en</b>, задержанный на 1 такт синхросигнала памяти. Таким образом достигается покрытие 2 тактов при поиске валидного положения маски.</p>
      <p>Результат тренинга записывается в <b>dfi_rdlvl_resp</b>. Каждому байту данных соответствует своё значение <b>dfi_rdlvl_resp</b>, ассоциированное с соответствующим <b>sdram_dqs</b>.</p>
      <p>Для набора коэффициентов <b>dfi_rdlvl_gate_delay</b> составляется таблица значений <b>dfi_rdlvl_resp</b>. В соответствии с таблицей <b>ehl_ddr</b> производит выбор положения маски. Первая 1 в таблице результатов означает положение смещенной маски не более, чем в 45 градусах от фронта <b>sdram_dqs</b>. Оптимальное значение <b>dfi_rdlvl_gate_delay</b> задается после тренинга на 2 меньше текущего значения при получении первой единицы на <b>dfi_rdlvl_resp</b> (0b010 для следующей таблицы). <b style="color: #FF0000">[A-5-4-0]</b></p>
      <table summary="gate_trng" cellpadding="4" width="0%" border="1" cellspacing="0" rules="all">
         <colgroup><col><col></colgroup>
         <thead>
            <tr bgcolor="#C0C0C0">
               <th>dfi_rdlvl_gate_delay</th>
               <th>dfi_rdlvl_resp</th>
            </tr>
         </thead>
         <tbody>
            <tr> <td>0000</td> <td>0</td> </tr>
            <tr> <td>0001</td> <td>0</td> </tr>
            <tr> <td>0010</td> <td>0</td> </tr>
            <tr> <td>0011</td> <td>0</td> </tr>
            <tr> <td>0100</td> <td>1</td> </tr>
            <tr> <td>0101</td> <td>1</td> </tr>
            <tr> <td>0110</td> <td>1</td> </tr>
            <tr> <td>0111</td> <td>1</td> </tr>
            <tr> <td>1000</td> <td>0</td> </tr>
            <tr> <td>1001</td> <td>0</td> </tr>
            <tr> <td>1010</td> <td>0</td> </tr>
            <tr> <td>1011</td> <td>0</td> </tr>
            <tr> <td>1100</td> <td>1</td> </tr>
            <tr> <td>1101</td> <td>1</td> </tr>
            <tr> <td>1110</td> <td>1</td> </tr>
            <tr> <td>1111</td> <td>1</td> </tr>
         </tbody>
      </table>
      <img src="um_trng_gate.png"></a>
      <p>Рисунок 6. Тренинг положения маски строба DQS</p>
      <h3 style="color: #0000CC">Тренинг положения стробов</h3>
      <p>Тренинг положения стробов [2, раздел 4.9.4.1.1  - data eye training] выполняется для gated версии сигнала <b>sdram_dqs</b> (<b>sdram_dqs_n</b> использует тот же коэффициент). Перед процедурой следует записать по нулевому адресу данные вида 0xFF00FF00. В зависимости от параметров <b>AXI_WIDTH</b> и <b>SDRAM_WIDTH</b> записываемые данные должны иметь следующий вид (младший байт 0x00 соответствует наименьшему адресу, т.е. 0x0 в Big Endian):</p>
      <p>1. AXI_WIDTH = 32 и SDRAM_WIDTH = 8: 0xFF00FF00</p>
      <p>2. AXI_WIDTH = 32 и SDRAM_WIDTH = 16: 0xFFFF0000</p>
      <p>3. AXI_WIDTH = 64 и SDRAM_WIDTH = 8: 0xFF00FF00FF00FF00</p>
      <p>4. AXI_WIDTH = 64 и SDRAM_WIDTH = 16: 0xFFFF0000FFFF0000</p>
      <p>5. AXI_WIDTH = 64 и SDRAM_WIDTH = 32: 0xFFFFFFFF00000000</p>
      <p>6. AXI_WIDTH = 128 и SDRAM_WIDTH = 16: 0xFFFF0000FFFF0000FFFF0000FFFF0000</p>
      <p>7. AXI_WIDTH = 128 и SDRAM_WIDTH = 32: 0xFFFFFFFF00000000FFFFFFFF00000000</p>
      <p>8. AXI_WIDTH = 128 и SDRAM_WIDTH = 64: 0xFFFFFFFFFFFFFFFF0000000000000000</p>
      <p>Далее происходит чтение из памяти для каждого значения <b>dfi_rdlvl_delay</b> (Рисунок 7) для каждой байтовой линии данных.</p>
      <p>Если для всех значений <b>dfi_rdlvl_delay</b> прочитанные данные совпадают с ожидаемым значением (0x00), оптимальный результат соответствует смещению 90 градусов. В противном случае выбирается середина интервала, на котором были получены ожидаемые значения.</p>
      <img src="um_trng_data.png"></a>
      <p>Рисунок 7. Тренинг положения строба DQS</p>
      <h3 style="color: #0000CC">Запуск режима тренинга</h3>
      <p>Тренинг положения маски и стробов может быть выполнен в одном из двух режимов: автоматическом или ручном.</p>
      <p>В автоматическом режиме следует выполнить следующую последовательность:</p>
      <li> Убедиться, что в контроллере нет данных для записи/чтения (данная проверка должна выполняться мастером независимо от контроллера);</li>
      <li> Установить бит <b>DDR_CMD.RGT</b>;</li>
      <li> Ожидать сброса бита <b>DDR_CMD.RGT</b>, коэффициенты будут записаны в регистр <b>DDR_BYTE</b>x.<b>GTr</b>y;</li>
      <li> В конфигурации <b>ECC_ENA</b>=0b1 установить <b>DDR_EC.MODE</b>=0b10; записать последовательность данных 0x00-0xFF-0x00 <!--(как показано в 5.4.2)--> по адресу 0x0 для каждого ранка;</li>
      <li> Установить <b>DDR_EC.MODE</b>=0b00; записать последовательность данных 0x00-0xFF-0x00 <!--(как показано в 5.4.2)--> по адресу 0x0 для каждого ранка;</li>
      <li> Дождаться окончания записи;</li>
      <p><b style="color: #FF0000">Замечание. </b>Установка <b>DDR_EC.MODE</b>=0b00 позволяет избежать генерации прерываний от схемы проверки кода Хэмминга. При этом тренинг будет проводиться для всех байтовых линий, включая линию проверочных бит.</p>
      <li> Установить бит <b>DDR_CMD.RDET</b>;</li>
      <li> Ожидать сброса бита <b>DDR_CMD.RDET</b>, коэффициенты будут записаны в <b>DDR_BYTE</b>x.<b>DETr</b>y;</li>
      <p>Если результаты автоматического тренинга не приводят к стабильной работе контроллера, то следует провести тренинги в ручном режиме. Изначально проверить стабильность работы можно записав и прочитав тестовые данные по выбранному адресу памяти перед началом работы.</p>
      <p>В ручном режиме следует выполнить следующую последовательность:</p>
      <li> Убедиться, что в контроллере нет данных для записи/чтения (данная проверка должна выполняться мастером независимо от контроллера);</li>
      <li> Для каждого коэффициента (от 0 до 7) повторить следующую последовательность:</li>
      <ul><li> Записать коэффициент в <b>DDR_BYTE</b>x.<b>GTr</b>y;</li></ul>
      <ul><li> Установить <b>DDR_CMD.MGT</b>;</li></ul>
      <ul><li> Дождаться сброса <b>DDR_CMD.MGT</b>;</li></ul>
      <ul><li> Сохранить значение <b>DDR_BYTE</b>x<b>.RLS</b> для каждой байтовой линии;</li></ul>
      <li> Для каждой байтовой линии задать коэффициент <b>DDR_GT</b> таким образом, что он на 2 меньше коэффициента тренинга, при котором была обнаружена первая единица в <b>DDR_BYTE</b>x<b>.RLS</b>;</li>
      <li> В конфигурации <b>ECC_ENA</b>=0b1 установить <b>DDR_EC.MODE</b>=0b10;</li>
      <li> Записать последовательность данных 0x00-0xFF аналогично автоматическому режиму;</li>
      <li> Установить <b>DDR_EC.MODE</b>=0b00;</li>
      <li> Записать последовательность данных 0x00-0xFF аналогично автоматическому режиму;</li>
      <li> Для каждого коэффициента (от 0 до 7) повторить следующую последовательность:</li>
      <ul><li> Записать коэффициент в <b>DDR_BYTE</b>x.<b>DETr</b>y;</li></ul>
      <ul><li> Записать <b>DDR_EC.MODE</b>=0b00 для тренинга байтовых линий данных (исключая ECC);</li></ul>
      <ul><li> Прочитать данные из адреса 0x0;</li></ul>
      <ul><li> Для каждой байтовой линии считать результат 1, если данные первый байт для данной линии равен 0x00;</li></ul>
      <ul><li> В конфигурации <b>ECC_ENA</b>=0b1 дополнительно провести проверку для линии контрольных бит:</li></ul>
      <ul><ul><li> Записать <b>DDR_EC.MODE</b>=0b10;</li></ul></ul>
      <ul><ul><li> Прочитать данные из адреса 0x0;</li></ul></ul>
      <ul><ul><li> Считать результат 1, если младший байт равен 0x0;</li></ul></ul>
      <li> Для каждой байтовой линии задать коэффициент <b>DDR_BYTE</b>x.<b>DETr</b>y таким образом, что он равен половине разницы первого и последнего коэффициентов, давших результат 1, прибавленных к первому коэффициенту.</li>
      <h2><a name="ADDRDEC"></a>Кодирование адресов</h2>
      <p>Декодер адреса в составе контроллера производит преобразование адреса AXI в физический адрес памяти.  Декодирование состоит из нескольких операций:</p>
      <p>1. Преобразование байтового адреса AXI в адрес DFI. Ширина интерфейса DFI определяется параметром <b>SDRAM_WIDTH</b>. За 1 такт через DFI в формате HDR передаются данные для четырех последовательных адресов в памяти. Таким образом, параметр <b>SDRAM_WIDTH</b> определяет количество младших бит адреса AXI, которые не участвуют в формировании адреса SDRAM.</p>
      <p>2. Преобразование адреса DFI в адрес стеков, чипов, банков (и групп), строк и столбцов. Декодирование происходит в зависимости от сконфигурированного типа памяти.</p>

<p>Конфигурации x16 не поддерживаются в режиме <b>SDRAM_WIDTH</b>=8.</p>
<p><b style="color: #FF0000">Замечание</b>. Приведенная ниже таблица соответствует <b>DDR_TYPE.BGD</b>=0. Для <b>DDR_TYPE.BGD</b>=1 адрес "группа банков"[0] размещается между адресами "столбец"[2] и "столбец"[3]. Рекомендации по использованию см. в разделе "<a href="um_func.html#BG_MAP" class="olink">Использование адресов групп банков</a>".</p>
<p><b style="color: #FF0000">Замечание</b>. Приведенная ниже таблица представлена для случая с <b>RANK_CNT</b>=4. Для меньших значений, соответствующие биты адреса "чип" следует исключить.</p>
<!-- TODO: x16 3DS not supported by Jedec table 139 -->
      <table summary="addr_dec" cellpadding="4" width="0%" border="1" cellspacing="0" rules="all">
         <colgroup><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col></colgroup>
         <thead>
            <tr>
               <th bgcolor="#FF00FF" colspan="2"> стек</th>
               <th bgcolor="#00FF00" colspan="5"> чип</th>
               <th bgcolor="#0000FF" colspan="7"> строка</th>
               <th bgcolor="#FF0000" colspan="8"> банк</th>
               <th bgcolor="#00FFFF" colspan="9"> группа банков</th>
               <th bgcolor="#FFFF00" colspan="10"> столбец</th>
            </tr>
         </thead>
         <tbody>
            <tr bgcolor="#C0C0C0"> <td>SDRAM_WIDTH=8</td>  <td>38</td> <td>37</td> <td>36</td> <td>35</td> <td>34</td> <td>33</td> <td>32</td> <td>31</td> <td>30</td> <td>29</td> <td>28</td> <td>27</td> <td>26</td> <td>25</td> <td>24</td> <td>23</td> <td>22</td> <td>21</td> <td>20</td> <td>19</td> <td>18</td> <td>17</td> <td>16</td> <td>15</td> <td>14</td> <td>13</td> <td>12</td> <td>11</td> <td>10</td> <td>9</td>  <td>8</td>  <td>7</td>  <td>6</td> <td>5</td> <td>4</td> <td>3</td> <td>2</td> <td>1</td> <td>0</td> </tr>
            <tr bgcolor="#C0C0C0"> <td>SDRAM_WIDTH=16</td> <td></td>   <td>38</td> <td>37</td> <td>36</td> <td>35</td> <td>34</td> <td>33</td> <td>32</td> <td>31</td> <td>30</td> <td>29</td> <td>28</td> <td>27</td> <td>26</td> <td>25</td> <td>24</td> <td>23</td> <td>22</td> <td>21</td> <td>20</td> <td>19</td> <td>18</td> <td>17</td> <td>16</td> <td>15</td> <td>14</td> <td>13</td> <td>12</td> <td>11</td> <td>10</td> <td>9</td>  <td>8</td>  <td>7</td> <td>6</td> <td>5</td> <td>4</td> <td>3</td> <td>2</td> <td>1</td> </tr>
            <tr bgcolor="#C0C0C0"> <td>SDRAM_WIDTH=32</td> <td></td>   <td></td>   <td>38</td> <td>37</td> <td>36</td> <td>35</td> <td>34</td> <td>33</td> <td>32</td> <td>31</td> <td>30</td> <td>29</td> <td>28</td> <td>27</td> <td>26</td> <td>25</td> <td>24</td> <td>23</td> <td>22</td> <td>21</td> <td>20</td> <td>19</td> <td>18</td> <td>17</td> <td>16</td> <td>15</td> <td>14</td> <td>13</td> <td>12</td> <td>11</td> <td>10</td> <td>9</td>  <td>8</td> <td>7</td> <td>6</td> <td>5</td> <td>4</td> <td>3</td> <td>2</td> </tr>
            <tr bgcolor="#C0C0C0"> <td>SDRAM_WIDTH=64</td> <td></td>   <td></td>   <td></td>   <td>38</td> <td>37</td> <td>36</td> <td>35</td> <td>34</td> <td>33</td> <td>32</td> <td>31</td> <td>30</td> <td>29</td> <td>28</td> <td>27</td> <td>26</td> <td>25</td> <td>24</td> <td>23</td> <td>22</td> <td>21</td> <td>20</td> <td>19</td> <td>18</td> <td>17</td> <td>16</td> <td>15</td> <td>14</td> <td>13</td> <td>12</td> <td>11</td> <td>10</td> <td>9</td> <td>8</td> <td>7</td> <td>6</td> <td>5</td> <td>4</td> <td>3</td> </tr>
            <tr> <td>DDR2 128 Мбx16</td>             <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#FFFF00"> 8</td> <td bgcolor="#FFFF00"> 7</td> <td bgcolor="#FFFF00"> 6</td> <td bgcolor="#FFFF00"> 5</td> <td bgcolor="#FFFF00"> 4</td> <td bgcolor="#FFFF00"> 3</td> <td bgcolor="#FFFF00"> 2</td> <td bgcolor="#FFFF00"> 1</td> <td bgcolor="#FFFF00"> 0</td> </tr>
            <tr> <td>DDR2 256 Мбx8</td>              <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#00ff00"> 1</td> <td bgcolor="#00ff00"> 0</td> <td bgcolor="#0000ff">12</td> <td bgcolor="#0000ff">11</td> <td bgcolor="#0000ff">10</td> <td bgcolor="#0000ff"> 9</td> <td bgcolor="#0000ff"> 8</td> <td bgcolor="#0000ff"> 7</td> <td bgcolor="#0000ff"> 6</td> <td bgcolor="#0000ff"> 5</td> <td bgcolor="#0000ff"> 4</td> <td bgcolor="#0000ff"> 3</td> <td bgcolor="#0000ff"> 2</td> <td bgcolor="#0000ff"> 1</td> <td bgcolor="#0000ff"> 0</td> <td bgcolor="#ff0000"> 1</td> <td bgcolor="#ff0000"> 0</td> <td bgcolor="#ffff00"> 9</td> <td bgcolor="#ffff00"> 8</td> <td bgcolor="#ffff00"> 7</td> <td bgcolor="#ffff00"> 6</td> <td bgcolor="#ffff00"> 5</td> <td bgcolor="#ffff00"> 4</td> <td bgcolor="#ffff00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td>DDR2 256 Мбx16</td>             <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#ffff00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffFF00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td>DDR2 512 Мбx8</td>              <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#ffff00"> 9</td> <td bgcolor="#ffFF00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffff00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td>DDR2 512 Мбx16</td>             <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#FFFF00"> 9</td> <td bgcolor="#ffff00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffFF00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </td> </tr>
            <tr> <td>DDR3 512 Мбx8</td>              <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 2</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#ffff00"> 9</td> <td bgcolor="#ffFF00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffff00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td>DDR3 512 Мбx16</td>             <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 2</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#FFFF00"> 9</td> <td bgcolor="#ffff00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffFF00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td>DDR2/3 1 Гбx8</td>              <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 2</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#ffff00"> 9</td> <td bgcolor="#ffFF00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffff00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td>DDR2/3 1 Гбx16</td>             <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 2</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#FFFF00"> 9</td> <td bgcolor="#ffff00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffFF00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td>DDR2/3 2 Гбx8</td>              <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">14</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 2</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#ffff00"> 9</td> <td bgcolor="#ffFF00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffff00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td>DDR2/3 2 Гбx16</td>             <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 2</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#FFFF00"> 9</td> <td bgcolor="#ffff00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffFF00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td rowspan="2">DDR4 2 Гбx8</td>    <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#FF00FF"> 2</td> <td bgcolor="#FF00FF"> 1</td> <td bgcolor="#FF00FF"> 0</td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#00FFFF"> 1</td> <td bgcolor="#00FFFF"> 0</td> <td bgcolor="#ffff00"> 9</td> <td bgcolor="#ffFF00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffff00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr>                                     <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#FF00FF"> 2</td> <td bgcolor="#FF00FF"> 1</td> <td bgcolor="#FF00FF"> 0</td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#00FFFF"> 1</td> <td bgcolor="#ffff00"> 9</td> <td bgcolor="#ffFF00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffff00"> 3</td> <td bgcolor="#00FFFF"> 0</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td rowspan="2">DDR4 2 Гбx16</td>   <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#FF00FF"> 2</td> <td bgcolor="#FF00FF"> 1</td> <td bgcolor="#FF00FF"> 0</td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#00FFFF"> 0</td> <td bgcolor="#FFFF00"> 9</td> <td bgcolor="#ffff00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffFF00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr>                                     <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#FF00FF"> 2</td> <td bgcolor="#FF00FF"> 1</td> <td bgcolor="#FF00FF"> 0</td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#FFFF00"> 9</td> <td bgcolor="#ffff00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffFF00"> 3</td> <td bgcolor="#00FFFF"> 0</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td>DDR2/3 4 Гбx8</td>              <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">15</td> <td bgcolor="#0000FF">14</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 2</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#ffff00"> 9</td> <td bgcolor="#ffFF00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffff00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td>DDR2/3 4 Гбx16</td>             <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">14</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 2</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#FFFF00"> 9</td> <td bgcolor="#ffff00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffFF00"> 3</td> <td bgcolor="#FFFF00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td rowspan="2">DDR4 4 Гбx8</td>    <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#FF00FF">2</td> <td bgcolor="#FF00FF"> 1</td> <td bgcolor="#FF00FF"> 0</td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">14</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#00FFFF"> 1</td> <td bgcolor="#00FFFF"> 0</td> <td bgcolor="#ffff00"> 9</td> <td bgcolor="#ffFF00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffff00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr>                                     <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#FF00FF">2</td> <td bgcolor="#FF00FF"> 1</td> <td bgcolor="#FF00FF"> 0</td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">14</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#00FFFF"> 1</td> <td bgcolor="#ffff00"> 9</td> <td bgcolor="#ffFF00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffff00"> 3</td> <td bgcolor="#00FFFF"> 0</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td rowspan="2">DDR4 4 Гбx16</td>   <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#FF00FF"> 2</td> <td bgcolor="#FF00FF"> 1</td> <td bgcolor="#FF00FF"> 0</td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">14</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#00FFFF"> 0</td> <td bgcolor="#FFFF00"> 9</td> <td bgcolor="#ffff00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffFF00"> 3</td> <td bgcolor="#FFFF00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr>                                     <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#FF00FF"> 2</td> <td bgcolor="#FF00FF"> 1</td> <td bgcolor="#FF00FF"> 0</td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">14</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#FFFF00"> 9</td> <td bgcolor="#ffff00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffFF00"> 3</td> <td bgcolor="#00FFFF"> 0</td> <td bgcolor="#FFFF00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td>DDR3 8 Гбx8</td>                <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">15</td> <td bgcolor="#0000FF">14</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 2</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#FFFF00">10</td> <td bgcolor="#ffff00"> 9</td> <td bgcolor="#ffFF00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffff00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td>DDR3 8 Гбx16</td>               <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#C0C0C0">  </td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">15</td> <td bgcolor="#0000FF">14</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 2</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#FFFF00"> 9</td> <td bgcolor="#ffff00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffFF00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td rowspan="2">DDR4 8 Гбx8</td>    <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#FF00FF">2</td> <td bgcolor="#FF00FF">1</td> <td bgcolor="#FF00FF"> 0</td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">15</td> <td bgcolor="#0000FF">14</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#00FFFF"> 1</td> <td bgcolor="#00FFFF"> 0</td> <td bgcolor="#ffff00"> 9</td> <td bgcolor="#ffFF00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffff00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr>                                     <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#FF00FF">2</td> <td bgcolor="#FF00FF">1</td> <td bgcolor="#FF00FF"> 0</td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">15</td> <td bgcolor="#0000FF">14</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#00FFFF"> 1</td> <td bgcolor="#ffff00"> 9</td> <td bgcolor="#ffFF00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffff00"> 3</td> <td bgcolor="#00FFFF"> 0</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td rowspan="2">DDR4 8 Гбx16</td>   <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#FF00FF">2</td> <td bgcolor="#FF00FF"> 1</td> <td bgcolor="#FF00FF"> 0</td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">15</td> <td bgcolor="#0000FF">14</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#00FFFF"> 0</td> <td bgcolor="#FFFF00"> 9</td> <td bgcolor="#ffff00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffFF00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr>                                     <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#FF00FF">2</td> <td bgcolor="#FF00FF"> 1</td> <td bgcolor="#FF00FF"> 0</td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">15</td> <td bgcolor="#0000FF">14</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#FFFF00"> 9</td> <td bgcolor="#ffff00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffFF00"> 3</td> <td bgcolor="#00FFFF"> 0</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td rowspan="2">DDR4 16 Гбx8</td>   <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#FF00FF">2</td> <td bgcolor="#FF00FF">1</td> <td bgcolor="#FF00FF">0</td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">16</td> <td bgcolor="#0000FF">15</td> <td bgcolor="#0000FF">14</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#00FFFF"> 1</td> <td bgcolor="#00FFFF"> 0</td> <td bgcolor="#ffff00"> 9</td> <td bgcolor="#ffFF00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffff00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr>                                     <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#FF00FF">2</td> <td bgcolor="#FF00FF">1</td> <td bgcolor="#FF00FF">0</td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">16</td> <td bgcolor="#0000FF">15</td> <td bgcolor="#0000FF">14</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#00FFFF"> 1</td> <td bgcolor="#ffff00"> 9</td> <td bgcolor="#ffFF00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffff00"> 3</td> <td bgcolor="#00FFFF"> 0</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </tr>
            <tr> <td rowspan="2">DDR4 16 Гбx16</td>  <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#FF00FF">2</td> <td bgcolor="#FF00FF">1</td> <td bgcolor="#FF00FF"> 0</td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">16</td> <td bgcolor="#0000FF">15</td> <td bgcolor="#0000FF">14</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#00FFFF"> 0</td> <td bgcolor="#FFFF00"> 9</td> <td bgcolor="#ffff00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffFF00"> 3</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </td> </tr>
            <tr>                                     <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#C0C0C0"> </td> <td bgcolor="#FF00FF">2</td> <td bgcolor="#FF00FF">1</td> <td bgcolor="#FF00FF"> 0</td> <td bgcolor="#00FF00"> 1</td> <td bgcolor="#00FF00"> 0</td> <td bgcolor="#0000FF">16</td> <td bgcolor="#0000FF">15</td> <td bgcolor="#0000FF">14</td> <td bgcolor="#0000FF">13</td> <td bgcolor="#0000FF">12</td> <td bgcolor="#0000FF">11</td> <td bgcolor="#0000FF">10</td> <td bgcolor="#0000FF"> 9</td> <td bgcolor="#0000FF"> 8</td> <td bgcolor="#0000FF"> 7</td> <td bgcolor="#0000FF"> 6</td> <td bgcolor="#0000FF"> 5</td> <td bgcolor="#0000FF"> 4</td> <td bgcolor="#0000FF"> 3</td> <td bgcolor="#0000FF"> 2</td> <td bgcolor="#0000FF"> 1</td> <td bgcolor="#0000FF"> 0</td> <td bgcolor="#FF0000"> 1</td> <td bgcolor="#FF0000"> 0</td> <td bgcolor="#FFFF00"> 9</td> <td bgcolor="#ffff00"> 8</td> <td bgcolor="#ffFF00"> 7</td> <td bgcolor="#ffFF00"> 6</td> <td bgcolor="#ffFF00"> 5</td> <td bgcolor="#ffFF00"> 4</td> <td bgcolor="#ffFF00"> 3</td> <td bgcolor="#00FFFF"> 0</td> <td bgcolor="#ffff00"> 2</td> <td bgcolor="#ffff00"> 1</td> <td bgcolor="#ffff00"> 0</td> </td> </tr>
         </tbody>
      </table>

      <p>Режимы 128 и 256 Мб поддерживаются только памятью DDR2. Режим 8 Гб только памятью DDR3/4. Режим 16 Гб только памятью DDR4.</p>
      <p>Режим 512 Мб использует различное распределение адресов между банками/строками для DDR2 и DDR3.</p>

      <h3><a name="BG_MAP"></a>Использование адресов групп банков</h3>
      <p>
         Спецификация DDR4 [12] вводит новую структуру организации памяти с введением групп банков. Вместе с ними появляется разделение параметра tCCD на tCCD_L и tCCD_S. S/L обозначают short и long.
         Согласно [12] последовательный доступ к страницам в одной группе банков требует использования параметра tCCD_L между командами записи/чтения.
         При обращении к разным группам банков требуется использовать параметр tCCD_S. tCCD_S равен 4, а значение tCCD_L зависит от скорости и варьируется от 5 до 8.
         Исходя из этого последовательные обращения к памяти внутри одной группы банков требует от 5 до 8 тактов при использовании Burst Length = 8 это дает от 1 до 4 тактов паузы между командами.
      </p>
      <img src="um_bg_map_0.png"></a>
      <p>Рисунок. Чтение из последовательных адресов в режиме DDR4-3200 при <b>DDR_TYPE.BGD</b>=0.</p>
      <img src="um_bg_map_1.png"></a>
      <p>Рисунок. Чтение из последовательных адресов в режиме DDR4-3200 при <b>DDR_TYPE.BGD</b>=1.</p>
      <p>
         В зависимости от типа передаваемых данных можно выбрать различные альтернативы для кодирования адресов групп банков.
         Если использование контроллера подразумевает обращение к большим последовательным областям памяти (например, при буферировании видеоизображений, Ethernet пакетов и т.д.), то рекомендуется использовать <b>DDR_TYPE.BGD</b>=1.
         В этом случае перед первым обращением будет активирована страница в банке BG0=0, перед вторым в банке BG0=1, а далее все обращения будут происходить без пауз между командами с попеременным обращениям к группам банков.
      </p>
      <p>
         В случае применения контроллера для зачитывания небольших объемов данных (например, строк кэша) обращения могут носить случайный характер и при необходимости прочитать/записать данные, объем которых соответствует двум SDRAM командам, будет выполняться следующая последовательность:
      </p>
      <p>
         <b>DDR_TYPE.BGD</b>=0: активация страницы, чтение/запись, 1-4 такта паузы, чтение/запись.
      </p>
      <p>
         <b>DDR_TYPE.BGD</b>=1: активация страницы в BG0=0, чтение/запись, активация страницы в BG0=1, чтение/запись.
      </p>
      <p>
         Следует выбирать кодирование адресов для данного типа трафика исходя из соотношения временных параметров.
      </p>

      <h2><a name="PAGE"></a>Управление страницами</h2>
      <p>Контроллер управляет открытием страниц, к которым происходит обращение. Система динамической памяти имеет следующий вид. Несколько чипов могут быть подключены параллельно с использованием сигнала <b>dfi_cs_n</b> (вывод <b>sdram_cs_n</b> PHY) для определения чипа, к которому происходит обращение. Внутри каждого чипа имеется 4 или 8 банков. Каждый банк содержит набор страниц (строк), каждая строка набор столбцов. Столбец состоит из 8 или 16 бит (4 не поддерживаются). Конкретное количество банков, страниц, столбцов и бит внутри столбца определяется структурой памяти.</p>
      <p>Чтобы обратиться к столбцу памяти, страницу, на которой он находится, следует активировать (открыть). По окончании обращения страница должна быть закрыта до наступления команды регенерации (REFRESH) или до обращения к другой странице в банке.</p>
      <p>Из-за особенностей динамической памяти следует периодически посылать команду REFRESH, которая обновляет содержимое страницы. Перед этим все открытые страницы должны быть закрыты. <b>ehl_ddr</b> автоматически выполняет управление открытием и закрытием нужных страниц. Следующие процедуры применяются при работе контроллера:</p>
      <li> одновременно может быть открыто по одной странице для каждого банка каждого чипа; [A-5-6-0]</li>
      <li> перед запросом REFRESH все открытые страницы закрываются;</li>
      <li> перед запросом SELF-REFRESH или POWER-DOWN все открытые страницы закрываются;</li>
      <li> перед обращением READ/WRITE закрывается открытая страница адресуемого банка (если таковая была открыта и отлична от текущей адресуемой), открывается требуемая страница (если она не была открыта до обращения);</li>
      <li> по окончании READ/WRITE страница остается открытой, делая возможным последующее обращение к ней без необходимости повторного открытия;</li>
      <h2><a name="ECC"></a>Коррекция ошибок</h2>
      <p>Если <b>ehl_ddr</b> сконфигурирован с поддержкой коррекции ошибок (параметр <b>ECC_ENA</b>) и коррекция разрешена программно (раздел "<a href="um_func.html" class="olink">Функционирование</a>"), блок производит генерацию контрольных бит перед записью в память и их проверку при чтении из памяти. Для контрольных бит используется код Хэмминга. Неиспользуемые биты при записи дополняются до 8 нулями. Каждому набору данных в формате DDR соответствуют свои контрольные биты. Таким образом <b>ehl_ddr</b> генерирует и проверяет контрольные биты отдельно для старшей и младшей частей данных в формате SDR.</p>
      <table summary="ecc" cellpadding="4" width="0%" border="1" cellspacing="0" rules="all">
         <colgroup><col><col></colgroup>
         <thead>
            <tr bgcolor="#C0C0C0">
               <th>SDRAM_WIDTH</th>
               <th>Кол-во проверочных бит</th>
            </tr>
         </thead>
         <tbody>
            <tr> <td>8</td> <td>5</td> </tr>
            <tr> <td>16</td> <td>6</td> </tr>
            <tr> <td>32</td> <td>7</td> </tr>
            <tr> <td>64</td> <td>8</td> </tr>
         </tbody>
      </table>
      <p>Код Хэмминга исправляет одну ошибку и обнаруживает 2 ошибки во всем слове данных. В случае обнаружения неисправимой ошибки модуль генерирует ERROR RESPONSE для данной транзакции на шине AXI.[A-5-7-0]</p>
      <p>При чтении производится проверка контрольных бит. В случае обнаружения единичной ошибки, адрес транзакции помещается в FIFO ошибочных адресов (если установлен бит <b>DDR_EC.WB</b>) для последующего исправления в режиме Read-Modify-Write. Адрес ошибочной транзакции помещается в <b>DDR_ECC_FIFO</b> при наличии в нем свободного места, и происходит инкремент <b>DDR_EC.Cnt_SERR</b>.[A-5-7-1]</p>
      <p>При обнаружении ошибок в обоих частях данных SDR, значение <b>Cnt_SERR</b> увеличивается на 2. В случае наличия неисправимой ошибки, данные передаются в READ CHANNEL DATA/RESPONSE FIFO без изменений, а соответствующий им тип отклика устанавливается SLVERR.</p>
      <p>При обнаружении неисправимой ошибки инкрементируется <b>DDR_EC.Cnt_DERR</b> [A-5-7-2], а адрес памяти, по которому произошла ошибка, сохраняется в <b>DDR_ECC_FIFO</b>. Данные остаются неизменными.</p>
      <p>При записи происходит генерация контрольных бит и запись их в старший байт данных на шине DFI. Если записываемые данные по ширине меньше ширины шины памяти, то запись производится по схеме Read-Modify-Write. При этом если в процессе чтения обнаружена ошибка, данные корректируются и записываются вместе с новыми данными. Если ошибку исправить не удалось, выдается ERROR RESPONSE на шине AXI.</p>
      <p>Коррекция производится по окончании исполнения команд чтения и записи, которые уже были переданы на обработку (не более 2 транзакций AXI). По окончании исполнения текущих команд, если имеется хотя бы один адрес с исправляемыми ошибками, контроллер переходит в режим исправления. Этот режим выполняется аналогично Read-Modify-Write, только без установки флагов обнаружения ошибок, генерации откликов AXI и с полностью маскированными данными для записи. Контроллер может хранить до <b>ERROR_FIFO_DEPTH</b> значений ошибочных адресов BURST. Таким образом, если в двух транзакциях AXI быть обнаружено большее количество ошибок, то контроллер исправит только первые из них. Это ограничение аналогично ограничению на корректирующую способность кода Хэмминга. Увеличение значение параметра <b>ERROR_FIFO_DEPTH</b> может позволить исправлять все ошибки, но затруднит выполнение требований по максимальной тактовой частоте.</p>
      <p><b>Примечание</b>. Для коррекции ошибок выбран режим Read-Modify-Write с повторным чтением данных в связи с тем, что исправление данных на лету затруднено конвейерной архитектурой дизайна. В момент обнаружения ошибки, в конвейере команд может находиться несколько транзакций, каждая из которых потенциально может содержать ошибки, и для хранения прочитанных данных требуется большой буфер. В целом ошибки при работе с памятью являются не типичным случаем, и алгоритм исправления выбран для сокращения аппаратных ресурсов при увеличенном времени исправления ошибки.</p>
      <p>Диагностика возникновения ошибок может быть выполнена с помощью анализа адреса источника ошибки в <b>DDR_ECC_FIFO</b>. Положение сбойного бита в случае одиночной ошибки отслеживается с помощью регистров <b>DDR_ECC_SE_PAT</b>x.</p>
      <h2><a name="DFI"></a>Интерфейс DFI</h2>
      <p>Коммуникация контроллера с динамической памятью осуществляется через интерфейс DFI. Временные характеристики интерфейса определяются используемым типом PHY и задаются в регистре <b>DDR_PHY</b>.</p>
<!--       <p><b style="color: #FF0000">Замечание</b>. Текущая ревизия <b>ehl_ddr</b> не поддерживает изменение значений <b>ctrl_delay</b> и <b>phy_rdlat</b>, которые не используются контроллером.</p> -->
<!-- TODO: add more pictures on rdcs and report typo in standard -->
      <img src="um_phy_ctrl_delay.png"></a>
<pre class="small">                       ________          ________          ________        </pre>
<pre class="small">  mctrl_clk:     _____|        |________|        |________|        |_______</pre>
<pre class="small">                 _______                :  _______________:________________</pre>
<pre class="small">  dfi_cas_n:            \_______________:_/               :                </pre>
<pre class="small">                 _______________________:_                :  ______________</pre>
<pre class="small">  sdram_cas_n:                          : \_______________:_/              </pre>
<pre class="small">                                        :                 :                </pre>
<pre class="small">                                        :<---ctrl_delay-->:                </pre>

      <p>Рисунок 8. PHY Control Interface timing</p>
<!--       <p>Определение значения <b>DDR_PHY.TCD</b> проиллюстрировано на Рисунок 8 (в указанном примере равен 1).</p> -->
      <img src="um_phy_wrlat.png"></a>
      <p>Рисунок 9. PHY Write Data timing</p>
<!-- TODO: переписать на HDR -->
      <p>Определение значения <b>DDR_PHY.TWL</b> проиллюстрировано на рисунке 9 (в указанном примере равен 2).</p>
      <img src="um_phy_read.png"></a>
      <p>Рисунок 10. PHY Read Data timing</p>
      <p><!--Определение значения <b>DDR_PHY.TRL</b> проиллюстрировано на Рисунок 10 (в указанном примере равен 3). -->Определение значения <b>DDR_PHY.TRE</b> проиллюстрировано на рисунке 10 (в указанном примере равен 2).</p>
      <h2><a name="LP"></a>Режимы пониженного энергопотребления</h2>
      <p><b>ehl_ddr</b> поддерживает 2 режима пониженного энергопотребления: Self-Refresh и Precharge Power-Down управляемых с помощью регистров <b>DDR_CMD</b> и <b>DDR2_CTRL</b>.</p>

      <p><b style="color: #FF0000">Замечание.</b> Протокол перевода памяти в режим пониженного энергоптребления выглядит следующим образом:</p>
      <p>1. Следует установить бит <b>DDR_CMD.SR</b> или <b>DDR_CMD.PD</b>.</p>
      <p>2. Следует отслеживать состояние указанных в п.1 бит.</p>
      <p>
         Если бит сброшен, то контроллер не смог перейти в режим пониженного энергопотребления по одной из причин, указанных в описании бит.
         В данном случае можно повторно запросить переход в режим пониженного энергопотребления, перейдя к п.1.
      </p>
      <p>
         При установленном бите следует дождаться установки <b>DDR_CMD.LPM</b>. После этого память переведена в режим пониженного энергопотребления.
      </p>
      <p>
         Необходимость отслеживания состояния обусловлена тем, что после принятия запроса на переход в режим пониженного энергопотребления происходит прохождение команды через очередь команд контроллера.
         Очередь может содержать команды, требуеющие значительного времени исполнения (например, REFRESH или ZQC).
         В этом случае возможна ситуация, когда память еще не переведена в режим пониженного энергопотребления, но уже выводится из него одним из возможных способов.
         Такая последовательность действий недопустима и должна избегаться при работе с контроллером.
      </p>

      <h3 style="color: #0000CC">Режим Power-Down</h3>
      <p>Режим Power-Down предназначен для сокращения потребления динамической памяти в случаях, когда к ней не происходит обращения. <b>ehl_ddr</b> поддерживает только режим PRECHARGE Power-Down. Таким образом, перед переходом в режим <b>ehl_ddr</b> закрывает все открытые страницы. Переход в режим осуществляется в одном из двух случаев: программно при установке бита <b>DDR_CMD.PD</b> или аппаратно при достижении интервала неактивности интерфейса <b>DDR2_CTRL.PDI</b>.[A-5-8-0]</p>
      <p>Установка <b>DDR_CMD.PD</b> не приведет к переходу в режим Power-Down, если контроллеру предстоит выполнить команду REFRESH, команду ZQCS, или в буфере AXI имеются команды чтения или записи.[A-5-8-1]</p>
      <p>В режиме Power-Down микросхема памяти требует периодического выполнения команды REFRESH, поэтому выход из режима может быть выполнен либо программно, либо аппаратно при достижении интервала <b>DDR_TIME1.tREFI</b>.[A-5-8-2]</p>
      <h3 style="color: #0000CC">Режим Self-Refresh</h3>
      <p>Режим Self-Refresh переводит динамическую память в состояние автоматического обновления содержимого. Таким образом память сохраняет содержимое, независимо от наличия питания системы, содержащей контроллер памяти.</p>
      <p>Переход в режим осуществляется программно установкой <b>DDR_CMD.SR</b>. Установка <b>DDR_CMD.SR</b> не приведет к переходу в режим Self-Refresh, если в буфере AXI имеются команды чтения или записи. [A-5-8-3] Если установлен бит <b>DDR2_CTRL.DCDM</b>, то при переходе в режим Self-Refresh будет отключена частота памяти (если PHY поддерживает сигнал <b>dfi_dram_clk_disable</b>). Параметры tCKSRX и tCKSRE выполняются автоматически.</p>
      <p>После выхода из режима контроллер автоматически 2 раза выполнит команду REFRESH для восстановления периодичности обновления данных. [A-5-8-4] В режиме DDR3 при выходе из Self-Refresh также выполняется команда ZQCS.</p>
      <p>Рекомендуется отключить режим автоматического перехода в Precharge Power-Down (сбросив <b>DDR2_CTRL.PDI</b>) перед переходом в Self-Refresh<!-- <b>todo: (Сделать бит auto-pd доступным программно, чтобы при переходе в PD, когда уже есть APD не долбиться в цикле с опросом бита)</b>-->. При некоторых соотношениях частот может наблюдаться последовательность перехода в автоматический режим Precharge Power-Down / запрос на переход в Self-Refresh с одновременным выходом из Precharge Power-Down и игнорированием запроса на переход в Self-Refresh. При достаточно малых значениех <b>DDR2_CTRL.PDI</b> контроллер может снова зайти в Power Down перед следующим циклическим запросом Self-Refresh. Такой цикл может повторять до прихода REFRESH, который отложит переход в Power Down и приведет к переходу в Self-Refresh. В общем случае рекомендуется выбрать один из режимов снижение энергопотребления и механизмов перехода к режимам, чтобы избежать подобных конфликтов.</p>
      <p>Текущее состояние энергопотребления определяется следующим образом.</p>
      <table summary="low_power" cellpadding="4" width="0%" border="1" cellspacing="0" rules="all">
         <colgroup><col><col><col><col></colgroup>
         <thead>
            <tr bgcolor="#C0C0C0">
               <th>DDR2_CTRL.SR</th>
               <th>DDR2_CTRL.PD</th>
               <th>DDR2_CTRL.LPM</th>
               <th>Режим</th>
            </tr>
         </thead>
         <tbody>
            <tr> <td>1</td> <td>0</td> <td>1</td> <td>Self-Refresh</td> </tr>
            <tr> <td>0</td> <td>1</td> <td>1</td> <td>Precharge Power Down</td> </tr>
            <tr> <td>0</td> <td>0</td> <td>1</td> <td>Автоматический Precharge Power Down</td> </tr>
            <tr> <td>x</td> <td>x</td> <td>0</td> <td>Рабочий</td> </tr>
         </tbody>
      </table>
      <h3 style="color: #0000CC"><a name="DLL_INIT"></a>Изменение тактовой частоты</h3>
      <p>В режиме Self-Refresh допускается изменение значения тактовой частоты системы динамической памяти [1 3.10] [8 4.7]. Изменение тактовой частоты в режиме Precharge Power Down [1 3.13] [8 4.7] не поддерживается. Перед выходом из режима тактовая частота должна быть стабильна. Для корректного изменения тактовой частоты следует выполнить следующую последовательность:</p>
      <li> Перевести DLL в режим bypass установкой <b>PHY_DLL_CTRL.DB</b>.</li>
      <li> Задать значение <b>PHY_DLL_CTRL.HF</b>, соответствующее новому значению тактовой частоты,</li>
      <li> Изменить тактовую частоту (изменение не должно приводить к возникновению просечек синхросигнала),</li>
      <li> Проинициализировать DLL последовательной установкой и сбросом <b>DDR_PHY.DLLR</b>.</li>
      <li> Дождаться подстройки всех DLL контроллера, ожидая установки <b>PHY_DLL_CTRL.DL</b>.</li>
      <li> Вывести DLL из режима bypass, сбросив <b>PHY_DLL_CTRL.DB</b>.</li>
      <p><b style="color: #FF0000">Замечание. </b> Для корректной работы памяти после изменения тактовой частоты (за исключением минимального изменения порядка единиц МГц) потребуется изменение значений Mode Registers и последующее проведение тренингов с обновлением коэффициентов.</p>
      <h3 style="color: #0000CC"><a name="DLL_INIT"></a>Сокращение токов контактных площадок</h3>
      <p>При использовании контроллера с <b>PHY_TYPE</b>=0 возможно снизить потребляемый ток контактных площадок, установив <b>PHY_IO_CTRL.TOID</b>.
      Это реализуется переводом драйверов контактных площадок команд и адреса в третье состояние вместо подачи на них неактивных логических значений. Поскольку логические уровни SSTL отличаются от земли и питания, неактивные логические уровни приводят к токам утечки. Если же драйверы отключены (что допускается стандартом), то утечек не происходит.
      </p>
      <p>Возможность реализации данного режима при использовании других PHY следует уточнять в документации [9, 10, 11].</p>

      <h3 style="color: #0000CC"><a name="PASR"></a>Partial Array Self-Refresh</h3>
      <p>Режим PASR позволяет сократить энергопотребление памяти в режиме Self-Refresh. Это достигается за счет поддержания содержимого только части памяти, задаваемой в регистре <b>DDR_MR2.PASR</b>. Следует иметь в виду, что механизм адресации, принятый в <b>ehl_ddr</b> не позволяет получить непрерывный диапазон адресов, соответствующий 1/2, или, например, 1/4 всего массива памяти. Это связано с тем, что адреса банков располагаются вслед за адресами столбцов, а не в старшей части адреса.</p>

      <p></p>
   </body>
</html>
