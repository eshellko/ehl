<html>
   <style> pre.small {line-height: 0.5; font-weight:bold; color: #FF00FF; }</style>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Функционирование</title>
   </head>
   <body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
      <h2>Функционирование</h2>

   <table cellpadding="4" width="90%" border="1" cellspacing="0" rules="all">
      <colgroup><col><col></colgroup>
      <thead> <tr bgcolor="#C0C0C0"> <th>SPI</th> <th>UART</th> </tr> </thead>
      <tbody>
         <tr  bgcolor="#F0F0F0"> <td  colspan="2"><b>Основные возможности</b></td> </tr>
         <tr> <td  colspan="2">Поддерживает конфигурацию Slave APB, имеет AMBA APB3 Protocol v1.0 пользовательский интерфейс;</td> </tr>
         <tr> <td  colspan="2">Отдельные буферы FIFO для приема и передачи размером до 128 байт;</td> </tr>
         <tr>
            <td>Поддерживает динамическую конфигурацию Master/Slave SPI;</td>
            <td>Поддерживает полнодуплексный последовательный асинхронный интерфейс;</td>
         </tr>
         <tr>
            <td>Поддерживает 4 режима передачи по SPI, в соответствии с фазой и полярностью синхросигнала.</td>
            <td>Программно настраиваемая длина байта - 5, 6, 7 или 8 бит с опциональным битом четности;</td>
         </tr>
         <tr>
            <td></td>
            <td>Конфигурируемая частота стробирования данных (1/4, 1/8, 1/16 поделенной частоты).</td>
         </tr>
         <tr  bgcolor="#F0F0F0"> <td  colspan="2"><b>Области применения</b></td> </tr>
         <tr>
            <td>Программирование энергонезависимой памяти;</td>
            <td>Кассовые терминалы;</td>
         </tr>
         <tr>
            <td>Управление контроллерами ЖК-экранов;</td>
            <td>Контроллеры технологических процессов;</td>
         </tr>
         <tr>
            <td>Управление АЦП/ЦАП, температурными датчиками;</td>
            <td>Коммуникация с микроконтроллерами и ПК.</td>
         </tr>
         <tr>
            <td>Коммуникация с микроконтроллерами.</td>
            <td></td>
         </tr>
      </tbody>
   </table>

   <h3>Перечень регистров</h3>
   <p>Регистры контроллера, доступные для управления пользователю.</p>
   <table cellpadding="4" width="0%" border="1" cellspacing="0" rules="all">
      <colgroup><col><col><col><col><col><col></colgroup>
      <thead>
         <tr bgcolor="#C0C0C0"> <th>Название</th> <th>Адрес</th> <th>Размер</th> <th>Доступ</th> <th>Начальное значение</th> <th>Описание</th> </tr>
      </thead>
      <tbody>
         <tr> <td>CTRL</td>       <td>0x0</td> <td>8</td> <td>R/W</td> <td>0x00</td> <td>Регистр управления</td> </tr>
         <tr> <td>STAT</td>       <td>0x1</td> <td>8</td> <td>R</td>   <td>0x00</td> <td>Регистр состояния</td> </tr>
         <tr> <td>CFG</td>        <td>0x2</td> <td>8</td> <td>R/W</td> <td>0x00</td> <td>Регистр настройки</td> </tr>
         <tr> <td>SSR</td>        <td>0x3</td> <td>8</td> <td>R/W</td> <td>0xFF</td> <td>Регистр выбора Slave устройства</td> </tr>
         <tr> <td>FCR</td>        <td>0x4</td> <td>8</td> <td>R/W</td> <td>0x00</td> <td>Регистр управления FIFO</td> </tr>
         <tr> <td>FSR</td>        <td>0x5</td> <td>8</td> <td>R</td>   <td>0x0A</td> <td>Регистр состояния FIFO</td> </tr>
         <tr> <td>CDR</td>        <td>0x6</td> <td>8</td> <td>R/W</td> <td>0x00</td> <td>Регистр деления частоты</td> </tr>
         <tr> <td>IER</td>        <td>0x7</td> <td>8</td> <td>R/W</td> <td>0x00</td> <td>Регистр разрешения прерываний</td> </tr>
         <tr> <td>IFR</td>        <td>0x8</td> <td>8</td> <td>R/W</td> <td>0x00</td> <td>Регистр флагов прерываний</td> </tr>
         <tr> <td>IMR</td>        <td>0x9</td> <td>8</td> <td>R/W</td> <td>0x00</td> <td>Регистр масок прерываний</td> </tr>
         <tr> <td>IOCFG</td>      <td>0xA</td> <td>8</td> <td>R/W</td> <td>0x00</td> <td>Регистр настройки интерфейса</td> </tr>
         <tr> <td>DR</td>         <td>0xB</td> <td>8</td> <td>R/W</td> <td>0x00</td> <td>Регистр данных</td> </tr>
         <tr> <td>RAS</td>        <td>0xC</td> <td>8</td> <td>R/W</td> <td>0x00</td> <td>Регистр управления RAS</td> </tr>
         <tr> <td>UFCR</td>       <td>0xD</td> <td>8</td> <td>R/W</td> <td>0x00</td> <td>Регистр аппаратного контроля обмена UART</td> </tr>
         <tr> <td>TXFIFO_LVL</td> <td>0xE</td> <td>8</td> <td>R/W</td> <td>0x00</td> <td>Порог генерации прерывания для буфера передатчика</td> </tr>
         <tr> <td>RXFIFO_LVL</td> <td>0xF</td> <td>8</td> <td>R/W</td> <td>0x00</td> <td>Порог генерации прерывания для буфера приемника</td> </tr>
      </tbody>
   </table>

   <p><a name="CTRL"></a><b style="color: #0000CC">CTRL [0x00] : </b>Регистр CTRL управляет разрешением передачи данных через контроллер.</p>
   <table cellpadding="4" width="100%" border="1" cellspacing="0" rules="all">
      <colgroup><col><col><col><col><col></colgroup>
      <thead>
         <tr bgcolor="#C0C0C0">
            <th>Биты</th>
            <th>Название</th>
            <th>Описание</th>
            <th>Доступ</th>
            <th>Начальное значение</th>
         </tr>
      </thead>
      <tbody>
         <tr> <td>7:3</td> <td>-</td> <td><b>Резерв</b></td> <td>R</td> <td>0</td> </tr>
         <tr>
            <td>2</td>
            <td>RE</td>
            <td>
               <b>Receive Enable</b>. Разрешение приема данных в режимах UART и SPI. Приемник определяется <b>CFG.MODE</b>.
               <li>0 - прием запрещен;</li>
               <li>1 - прием разрешен.</li>
               <p>В режиме UART (<b>CFG.MODE=1</b>) вход данных <b>sin</b> заменяется в приемнике на 1, если прием запрещен.</p>
               <p>В режиме SPI Master принятые данные не сохраняются в буфер, если прием запрещен.</p>
               <p>В режиме SPI Slave <!--вход данных <b>ss0_cts_i</b> заменяется в приемнике на 1, если прием запрещен--> данные принимаются независимо от значения <b>RE</b>.</p>
            </td>
            <td>R/W</td>
            <td>0</td>
         </tr>
         <tr>
            <td>1</td>
            <td>TE</td>
            <td>
               <b>Transmit Enable</b>. Разрешение передачи данных, находящихся в буфере передатчика в режимах UART и SPI. Передатчик определяется <b>CFG.MODE</b>.
               <li>0 - передача запрещена;</li>
               <li>1 - передача разрешена.</li>
            </td>
            <td>R/W</td>
            <td>0</td>
         </tr>
         <tr>
            <td>0</td>
            <td>SB</td>
            <td>
               <b>Send Break</b>. Управление передачей сигнала BREAK по окончании текущей передачи в режиме UART.
               Сброс сигнала <b>SB</b> приводит к передаче СТОП-бита.
               <li>0 - не передавать BREAK;</li>
               <li>1 - передача BREAK - линия <b>sout</b> притягивается к 0.</li>
               <p>
                  Поскольку длительность сигнала BREAK задается программно рекомендуется посылать BREAK длительностью не менее 2 байт данных (в соответствии с <b>CFG.BL</b> и <b>RAS.PAR</b>).
                  Это необходимо, чтобы учесть время передачи текущего передаваемого байта.
               </p>
               <p>
                  Не рекомендуется передавать BREAK часто. Между передачами BREAK следует выдержать паузу не менее длительности байта данных.
               </p>
               <p>Для передачи BREAK не обязательно задавать <b>CTRL.TE</b> равным 1. Передача BREAK сигнала будет осуществлена в любом случае.</p>
            </td>
            <td>R/W</td>
            <td>0 (1 при <b>DEVICE_CFG[0]</b>=0)</td>
         </tr>
      </tbody>
   </table>

   <p><a name="FCR"></a><b style="color: #0000CC">FCR [0x04] : </b>Регистр состояния настраивает следующие функции:</p>
   <ul>
   <li>сброс FIFO,</li>
   <li>сброс флагов переполнения буферов,</li>
   <li>отслеживание флагов переполнения буферов.</li>
   </ul>
   <p>Для сброса соответствующего флага переполнения следует записать в него 1.</p>
   <table cellpadding="4" width="0%" border="1" cellspacing="0" rules="all">
      <colgroup><col><col><col><col><col></colgroup>
      <thead>
         <tr bgcolor="#C0C0C0">
            <th>Биты</th>
            <th>Название</th>
            <th>Описание</th>
            <th>Доступ</th>
            <th>Начальное значение</th>
         </tr>
      </thead>
      <tbody>
         <tr> <td>7</td>   <td>RRF</td> <td><b>Reset Rx FIFO</b>. Запись 1 приводит к сбросу буфера приемника. Не следует сбрасывать FIFO при разрешенной работе приемника во избежание коллизий. Бит сбрасывается аппаратно.</td> <td>R/W/SC</td>  <td>0</td> </tr>
         <tr> <td>6</td>   <td>RTF</td> <td><b>Reset Tx FIFO</b>. Запись 1 приводит к сбросу буфера передатчика. Не следует сбрасывать FIFO при разрешенной работе передатчика во избежание коллизий. Бит сбрасывается аппаратно.</td> <td>R/W/SC</td> <td>0</td> </tr>
         <tr> <td>5:4</td> <td>-</td>   <td><b>Резерв</b></td> <td>R</td> <td>0</td> </tr>
         <tr> <td>3</td>   <td>RFU</td> <td><b>Rx FIFO Underflow</b>. Ошибка переполнения буфера <b>fifo_rx</b>. Устанавливается аппаратно при чтении <b>DR</b>, если <b>FSR.RxEmpty</b>=b'1.<li>0 - буфер не переполнен;</li><li>1 - буфер переполнен.</li></td> <td>R/W1C</td> <td>0</td> </tr>
         <tr> <td>2</td>   <td>RFO</td> <td><b>Rx FIFO Overflow</b>. Ошибка переполнения буфера <b>fifo_rx</b>. Устанавливается аппаратно при приеме байта через SPI / UART, если <b>FSR.RxFull</b>=b'1.<li>0 - буфер не переполнен;</li><li>1 - буфер переполнен.</li></td> <td>R/W1C</td> <td>0</td> </tr>
         <tr> <td>1</td>   <td>TFO</td> <td><b>Tx FIFO Overflow</b>. Ошибка переполнения буфера <b>fifo_tx</b>. Устанавливается аппаратно при записи <b>DR</b>, если <b>FSR.TxFull</b>=b'1.<li>0 - буфер не переполнен;</li><li>1 - буфер переполнен.</li></td> <td>R/W1C</td> <td>0</td> </tr>
         <tr> <td>0</td>   <td>TFU</td> <td><b>Tx FIFO Underflow</b>. Ошибка переполнения буфера <b>fifo_tx</b>. Установка флага возможна только в режиме Slave (<b>CFG.SM</b>=b'1) после начала трансфера при пустом буфере (<b>FSR.TxEmpty</b>=b'1).<li>0 - буфер не переполнен;</li><li>1 - буфер переполнен.</li></td> <td>R/W1C</td> <td>0</td> </tr>
      </tbody>
   </table>

   <p><a name="FSR"></a><b style="color: #0000CC">FSR [0x05] : </b>Регистр FIFO Status Register (FSR).</p>
   <table cellpadding="4" width="100%" border="1" cellspacing="0" rules="all">
      <colgroup><col><col><col><col><col></colgroup>
      <thead>
         <tr bgcolor="#C0C0C0">
            <th>Биты</th>
            <th>Название</th>
            <th>Описание</th>
            <th>Доступ</th>
            <th>Начальное значение</th>
         </tr>
      </thead>
      <tbody>
         <tr> <td>7</td> <td>RxAlmostFull</td>  <td> <b>Rx almost full</b>. Флаг наличия в буфере приемника одной свободной ячейки. <li>0 - в буфере больше или меньше одной свободной ячейки;</li> <li>1 - в буфере одна свободная ячейка.</li> </td> <td>R</td> <td>0</td> </tr>
         <tr> <td>6</td> <td>RxAlmostEmpty</td> <td> <b>Rx almost empty</b>. Флаг наличия в буфере приемника одного значения. <li>0 - в буфере больше или меньше одной заполненной ячейки;</li> <li>1 - в буфере одна заполненная ячейка.</li> </td> <td>R</td> <td>0</td> </tr>
         <tr> <td>5</td> <td>TxAlmostFull</td>  <td> <b>Tx almost full</b>. Флаг наличия в буфере передатчика одной свободной ячейки. <li>0 - в буфере больше или меньше одной свободной ячейки;</li> <li>1 - в буфере одна свободная ячейка.</li> </td> <td>R</td> <td>0</td> </tr>
         <tr> <td>4</td> <td>TxAlmostEmpty</td> <td> <b>Tx almost empty</b>. Флаг наличия в буфере передатчика одного значения. <li>0 - в буфере больше или меньше одной заполненной ячейки;</li> <li>1 - в буфере одна заполненная ячейка.</li> </td> <td>R</td> <td>0</td> </tr>
         <tr> <td>3</td> <td>RxEmpty</td>       <td> <b>Rx FIFO Empty</b>. Флаг опустошения буфера приемника. <li>0 - буфер не пуст;</li> <li>1 - буфер пуст.</li> </td> <td>R</td> <td>1</td> </tr>
         <tr> <td>2</td> <td>RxFull</td>        <td> <b>Rx FIFO Full</b>. Флаг заполнения буфера приемника. <li>0 - буфер не заполнен;</li> <li>1 - буфер заполнен.</li> </td> <td>R</td> <td>0</td> </tr>
         <tr> <td>1</td> <td>TxEmpty</td>       <td> <b>Tx FIFO Empty</b>. Флаг опустошения буфера передатчика. <li>0 - буфер не пуст;</li> <li>1 - буфер пуст.</li> </td> <td>R</td> <td>1</td> </tr>
         <tr> <td>0</td> <td>TxFull</td>        <td> <b>Tx FIFO Full</b>. Флаг заполнения буфера передатчика. <li>0 - буфер не заполнен;</li> <li>1 - буфер заполнен.</li> </td> <td>R</td> <td>0</td> </tr>
      </tbody>
   </table>

   <p><a name="CFG"></a><b style="color: #0000CC">CFG [0x02] : </b>Регистр настройки контроллера определяет режимы функционирования.</p>
   <table cellpadding="4" width="0%" border="1" cellspacing="0" rules="all">
      <colgroup><col><col><col><col><col></colgroup>
      <thead>
         <tr bgcolor="#C0C0C0">
            <th>Биты</th>
            <th>Название</th>
            <th>Описание</th>
            <th>Доступ</th>
            <th>Начальное значение</th>
         </tr>
      </thead>
      <tbody>
         <tr> <td>7</td>   <td>SM</td>   <td><b>SPI Mode</b>. Режим работы устройства SPI.<li>0 - Master;</li><li>1 - Slave.</li></td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>6</td>   <td>PHA</td>  <td><b>SPI Clock Phase</b>. Сдвиг данных <b>SIN</b>/<b>SOUT</b> относительно тактового сигнала <b>SCK</b>.</td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>5</td>   <td>POL</td>  <td><b>SPI Clock Polarity</b>. Значение тактового сигнала при отсутствии передачи.</td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>4:3</td> <td>BL</td>   <td><b>Byte Length</b>. Количество бит в байте данных UART. <li>00 - 8 бит;</li> <li>01 - 7 бит;</li> <li>10 - 6 бит;</li> <li>11 - 5 бит.</li> </td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>2</td>   <td>-</td>    <td> <b>Резерв</b>.</td> <td>R</td> <td>0</td> </tr>
         <tr> <td>1</td>   <td>TBO</td>  <td><b>Transfer Bit Order</b>. Порядок передачи бит через SPI/UART.<li>0 - первым передается / принимается LSB;</li><li>1 - первым передается / принимается MSB.</li></td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>0</td>   <td>MODE</td> <td>Режим работы:<li>0 - SPI;</li><li>1 - UART.</li></td> <td>R/W</td> <td>0</td> </tr>
      </tbody>
   </table>

   <hr>
   <h3>Порядок следования бит</h3>
   <hr>
<!-- Добавить картинку с последовательностью  бит, названиями стадий передачи и генерацией стробов -->
   <p>Порядок следования бит при трансфере через UART задается <b>CFG.TBO</b>. Бит <b>CFG.TBO</b> не влияет на порядок следования бит на <b>PWDATA</b>/<b>PRDATA</b> и в буфере. Порядок меняется при передаче через UART/SPI. При <b>CFG.TBO</b>=b'0 первым передаётся/принимается младший бит. При <b>CFG.TBO</b>=b'1 первым передаётся/принимается старший бит.</p>
   <p>
      Далее представлен пример влияния бита <b>CFG.TBO</b> на функционирование.
      Перед началом трансфера данные 0xD1 и 0x10 записаны через <b>PWDATA</b> в буфер передатчика.
      По окончании трансфера те же данные прочитаны через <b>PRDATA</b>.
      <b>CFG.PHA</b>=b'0. <b>CFG.POL</b>=b'0.
   </p>

<pre class="small">                                   CFG.TBO = 0                                                                     </pre>
<pre class="small">              __    __    __    __    __    __    __    __       __    __    __    __    __    __    __    __      </pre>
<pre class="small"> SCK  : _____|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |_____|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |_____</pre>
<pre class="small">            ____                   _____       ___________                            _____                        </pre>
<pre class="small"> SOUT : ___|    |_________________|     |_____|           |__________________________|     |_______________________</pre>
<pre class="small">                                                                                                                   </pre>
<pre class="small">                                   CFG.TBO = 1                                                                     </pre>
<pre class="small">              __    __    __    __    __    __    __    __       __    __    __    __    __    __    __    __      </pre>
<pre class="small"> SCK  : _____|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |_____|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |_____</pre>
<pre class="small">            __________       _____                   _____                      _____                              </pre>
<pre class="small"> SOUT : ___|          |_____|     |_________________|     |____________________|     |_____________________________</pre>

   <p><a name="CDR"></a><b style="color: #0000CC">CDR [0x06] : </b>Регистр деления тактовой частоты.</p>
   <table cellpadding="4" width="0%" border="1" cellspacing="0" rules="all">
      <colgroup><col><col><col><col><col></colgroup>
      <thead>
         <tr bgcolor="#C0C0C0">
            <th>Биты</th>
            <th>Название</th>
            <th>Описание</th>
            <th>Доступ</th>
            <th>Начальное значение</th>
         </tr>
      </thead>
      <tbody>
         <tr> <td>7:0</td> <td>VAL</td> <td>Коэффициент деления частоты <b>clk</b> для получения требуемой скорости передачи. Скорость передачи оперделяется как <b>Fpclk / (val + 1)</b>.</td> <td>R/W</td> <td>0</td> </tr>
      </tbody>
   </table>
   <p>
      Ядро контроллера тактируется частотой системной шины. Для получения требуемой скорости передачи интерфейса применяется регистр <b>CDR</b>.
      Он позволяет получить частоту <b>RCLK</b>, поделенную относительно системной частоты.
   </p>
   <ul>
   <pre class="small">              __    __    __    __    __    __    __    __    __    __    __    __    __    __    __    __       </pre>
   <pre class="small"> PCLK : _____|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |______</pre>
   <pre class="small">              __    __    __    __    __    __    __    __          __          __                __             </pre>
   <pre class="small"> RCLK : _____|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |________|  |________|  |______________|  |____________</pre>
   <pre class="small">                                                                                                                 </pre>
   <pre class="small">  CDR :       0                                         1                       2                                </pre>
   </ul>

   <p><a name="IOCFG"></a><b style="color: #0000CC">IOCFG [0x0A] : </b>регистр настройки интерфейса.</p>
   <table cellpadding="4" width="0%" border="1" cellspacing="0" rules="all">
      <colgroup><col><col><col><col><col></colgroup>
      <thead>
         <tr bgcolor="#C0C0C0">
            <th>Биты</th>
            <th>Название</th>
            <th>Описание</th>
            <th>Доступ</th>
            <th>Начальное значение</th>
         </tr>
      </thead>
      <tbody>
         <tr> <td>7:1</td> <td>-</td> <td><b>Резерв</b>.</td> <td>R</td> <td>0</td> </tr>
         <tr> <td>0</td>   <td>SOUT</td> <td>Разрешение перевода вывода <b>sout</b> в третье состояние (управляется выводом <b>sout_oe</b>) в режиме SPI Slave при неактивном <b>ss0_cts_i</b>:<li>0 - запрещено;</li><li>1 - разрешено.</li></td> <td>R/W</td> <td>0</td> </tr>
      </tbody>
   </table>

   <p><a name="RAS"></a><b style="color: #0000CC">RAS [0x0C] : </b>регистр управления функциями RAS позволяет включить дополнительные режимы, направленные на повышение надежности системы, в которой функционирует <b>ehl_lssi</b>.</p>
   <table cellpadding="4" width="0%" border="1" cellspacing="0" rules="all">
      <colgroup><col><col><col><col><col></colgroup>
      <thead>
         <tr bgcolor="#C0C0C0">
            <th>Биты</th>
            <th>Название</th>
            <th>Описание</th>
            <th>Доступ</th>
            <th>Начальное значение</th>
         </tr>
      </thead>
      <tbody>
         <tr> <td>7:2</td> <td>-</td> <td><b>Резерв</b>.</td> <td>R</td> <td>0</td> </tr>
         <tr> <td>1:0</td> <td>PAR</td> <td><b>Parity</b>. Разрешение использования бита четности UART:<li>00, 11 - запрещено;</li><li>01 - even;</li><li>10 - odd.</li></td> <td>R/W</td> <td>0</td> </tr>
      </tbody>
   </table>

   <p><a name="TXFIFO_LVL"></a><b style="color: #0000CC">TXFIFO_LVL [0x0E] : </b>Порог генерации прерывания для буфера передатчика.</p>
   <table cellpadding="4" width="0%" border="1" cellspacing="0" rules="all">
      <colgroup><col><col><col><col><col></colgroup>
      <thead>
         <tr bgcolor="#C0C0C0">
            <th>Биты</th>
            <th>Название</th>
            <th>Описание</th>
            <th>Доступ</th>
            <th>Начальное значение</th>
         </tr>
      </thead>
      <tbody>
         <tr> <td>7:0</td> <td>VAL</td> <td>Количество ячеек в буфере передатчика, при снижении до которого происходит генерация флага прерывания. Флаг устанавливается, если количество свободных ячеек меньше либо равно заданному в регистре.</td> <td>R/W</td> <td>0</td> </tr>
      </tbody>
   </table>

   <p><a name="RXFIFO_LVL"></a><b style="color: #0000CC">RXFIFO_LVL [0x0F] : </b>Порог генерации прерывания для буфера приемника.</p>
   <table cellpadding="4" width="0%" border="1" cellspacing="0" rules="all">
      <colgroup><col><col><col><col><col></colgroup>
      <thead>
         <tr bgcolor="#C0C0C0">
            <th>Биты</th>
            <th>Название</th>
            <th>Описание</th>
            <th>Доступ</th>
            <th>Начальное значение</th>
         </tr>
      </thead>
      <tbody>
         <tr> <td>7:0</td> <td>VAL</td> <td>Количество ячеек в буфере приемника, при повышении до которого происходит генерация флага прерывания. Флаг устанавливается, если количество занятых ячеек больше либо равно заданному в регистре. Начальное значение выбрано для избежания срабатывания при незапрограммированном регистре.<p>Начальное значение зависит от параметра <b>FIFO_SIZE</b>, биты превышающие двоичное значение параметра отсутсвуют и равны 0. Например, при <b>FIFO_SIZE</b> = 16, регистр содержит только 5 бит и его старшие 3 бита регистра всегда равны 0.</p></td> <td>R/W</td> <td>0xFF*</td> </tr>
      </tbody>
   </table>

   <p><a name="STAT"></a><b style="color: #0000CC">STAT [0x01] : </b>Регистр состояния приемо-передатчика STAT выполняет следующие функции:</p>
   <ul>
      <li> отслеживание состояния трансфера.</li>
   </ul>
   <table cellpadding="4" width="100%" border="1" cellspacing="0" rules="all">
      <colgroup><col><col><col><col><col></colgroup>
      <thead>
         <tr bgcolor="#C0C0C0">
            <th>Биты</th>
            <th>Название</th>
            <th>Описание</th>
            <th>Доступ</th>
            <th>Начальное значение</th>
         </tr>
      </thead>
      <tbody>
         <tr>
            <td>7:4</td>
            <td>-</td>
            <td><b>Резерв</b>.</td>
            <td>R</td>
            <td>0</td>
         </tr>
         <tr>
            <td>3</td>
            <td>RxIP</td>
            <td>
               <b>Receive In Progress</b>. Признак активности приемника UART. Устанавливается после обнаружения СТАРТ - бита на линии RX. Сбрасывается по окончании приема байта.
               <li>0 - прием не выполняется</li>
               <li>1 - прием выполняется</li>
            </td>
            <td>R</td>
            <td>0</td>
         </tr>
         <tr>
            <td>2</td>
            <td>TxIP</td>
            <td>
               <b>Transmit In Progress</b>. Признак активности передатчика UART. Устанавливается, если в передающем буфере имеются данные (<b>FSR.TxEmpty</b>=b'0) и передача разрешена (<b>CTRL.TE</b>=b'1). Сбрасывается по окончании передачи последнего байта, находившегося в буфере.
               <li>0 - трансфер не выполняется</li>
               <li>1 - трансфер выполняется</li>
            </td>
            <td>R</td>
            <td>0</td>
         </tr>
         <tr>
            <td>1</td>
            <td>-</td>
            <td> <b>Резерв</b>. </td>
            <td>R</td>
            <td>0</td>
         </tr>
         <tr>
            <td>0</td>
            <td>TIP</td>
            <td><p><b>Transfer In Progress</b>. Признак наличия трансфера по SPI.</p>
            <p>В режиме Master (<b>CFG.SM</b>=b'0) устанавливается, если в передающем буфере имеются данные (<b>FSR.TxEmpty</b>=b'0) и трансфер разрешен (<b>CTRL.TE</b>=b'1). Сбрасывается по окончании передачи последнего байта, находившегося в буфере или приостановке трансфера (<b>CTRL.TE</b>=b'0).</p>
            <p>В режиме Slave (<b>CFG.SM</b>=b'1) устанавливается после обнаружения перепада на <b>sck_i</b> (при <b>ss0_cts_i</b>=b'0). Сбрасывается после обнаружения 8-го перепада на <b>sck_i</b>.</p>
            <li>0 - трансфер не выполняется;</li> <li>1 - трансфер выполняется.</li></td>
            <td>R</td>
            <td>0</td>
         </tr>
      </tbody>
   </table>

   <hr>
   <h3>Работа с прерываниями</h3>
   <hr>
   <p>
      <b>ehl_lssi</b> поддерживает работу с прерываниями, включая разрешение и маскирование прерываний.
      Принцип работы следующий:
   </p>
   <ul>
   <li>Регистр <b>IFR</b> содержит флаги прерываний, соответствующие возникновению событий;</li>
   <li>Событие в <b>IFR</b> детектируется, если разрешено в <b>IER</b>;</li>
   <li>Событие приводит к генерации прерывания на выходе <b>irq</b>, если разрешено в <b>IMR</b>.</li>
   </ul>

   <p><a name="IER"></a><b style="color: #0000CC">IER [0x07] : </b>Регистр разрешения детектирования событий.
      Регистр флагов прерываний <b>IFR</b> имеет аналогичную структуру.
   </p>
   <table cellpadding="4" width="0%" border="1" cellspacing="0" rules="all">
      <colgroup><col><col><col><col><col></colgroup>
      <thead>
         <tr bgcolor="#C0C0C0">
            <th>Биты</th>
            <th>Название</th>
            <th>Описание</th>
            <th>Доступ</th>
            <th>Начальное значение</th>
         </tr>
      </thead>
      <tbody>
         <tr> <td>7</td> <td>FE</td> <td><b>Framing Error</b>. Разрешение детектирования события по некорректному принятому слову UART.<li>0 - запрещено;</li><li>1 - разрешено.</li></td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>6</td> <td>PE</td> <td><b>Parity Error</b>. Разрешение детектирования события по ошибке четности UART.<li>0 - запрещено;</li><li>1 - разрешено.</li></td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>5</td> <td>BD</td> <td><b>Break Detected</b>. Разрешение детектирования события по детектированию сигнала UART.<li>0 - запрещено;</li><li>1 - разрешено.</li></td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>4</td> <td>SB</td> <td><b>Short Byte</b>. Разрешение детектирования события при получении короткого байта (1-7 бит) в режиме SPI Slave.</td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>3</td> <td>BE</td> <td><b>Buffer Error</b>. Разрешение детектирования ошибок переполнения буферов. Соответствует флагам Overflow и Underflow регистра <b>FCR</b>.</td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>2</td> <td>TC</td> <td><b>Transfer Completed</b>. Разрешение детектирования опустошения буфера по окончании передачи в режимах UART и SPI Master.</td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>1</td> <td>RF</td> <td><b>Receive FIFO</b>. Разрешение детектирования события по порогу <b>RXFIFO_LVL</b>.<li>0 - запрещено;</li><li>1 - разрешено.</li></td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>0</td> <td>TF</td> <td><b>Transmit FIFO</b>. Разрешение детектирования события по порогу <b>TXFIFO_LVL</b>.<li>0 - запрещено;</li><li>1 - разрешено.</li></td> <td>R/W</td> <td>0</td> </tr>
      </tbody>
   </table>

   <p><a name="IFR"></a><b style="color: #0000CC">IFR [0x08] : </b>Регистр флагов прерываний. Запись 1 приводит к сбросу соответствующего бита регистра. Если при записи 1 не устранена причина возникновнения прерывания (для <b>RF</b> и <b>TF</b>) или одновременно возникло следующее событие, то бит не будет сброшен.</p>
   <table cellpadding="4" width="0%" border="1" cellspacing="0" rules="all">
      <colgroup><col><col><col><col><col></colgroup>
      <thead>
         <tr bgcolor="#C0C0C0">
            <th>Биты</th>
            <th>Название</th>
            <th>Описание</th>
            <th>Доступ</th>
            <th>Начальное значение</th>
         </tr>
      </thead>
      <tbody>
         <tr> <td>7</td> <td>FE</td> <td><b>Framing Error</b>. Устанавливается, если в принимаемом потоке не обнаружен СТОП - бит (линия <b>sin</b> равна b'0). За исключением сигнала BREAK, детектируемого <b>BD</b>. Байт без СТОП - бита не сохраняется в FIFO.<p>В случае одновременного наличия с ошибкой четности, <b>FE</b> имеет более выскоий приоритет.</p></td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>6</td> <td>PE</td> <td><b>Parity Error</b>. Устанавливается, если в принятом байте не совпадает значение бита четности. Может быть установлен, только если разрешен <b>RAS.PAR</b>. Байт с неправильным битом четности не сохраняется в буфер.</td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>5</td> <td>BD</td> <td><b>Break Detected</b>. Устанавливается, если принят байт, состоящий из 0 (длина задается <b>CFG.BL</b> и <b>RAS.PAR</b>), включая СТОП-бит. Байт не сохраняется в буфер.</td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>4</td> <td>SB</td> <td><b>Short Byte</b>. Устанавливается, если послений байт при приеме SPI Slave содержит от 1 до 7 бит данных. Байт не сохраняется в памяти.</td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>3</td> <td>BE</td> <td><b>Buffer Error</b>. Устанавливается, если установлен хотя бы 1 из 4 бит переполнения в регистре <b>FCR</b>.</td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>2</td> <td>TC</td> <td><b>Transfer Completed</b>. Устанавливается, если по окончании передачи UART / SPI Master в буфере передатчика не осталось данных.</td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>1</td> <td>RF</td> <td><b>Receive FIFO</b>. Прерывание по порогу <b>RXFIFO_LVL</b>.</td> <td>R/W</td> <td>0</td> </tr>
         <tr> <td>0</td> <td>TF</td> <td><b>Transmit FIFO</b>. Прерывание по порогу <b>TXFIFO_LVL</b>.</td> <td>R/W</td> <td>0</td> </tr>
      </tbody>
   </table>

   <p><a name="IMR"></a><b style="color: #0000CC">IMR [0x09] : </b>Регистр маскирования прерываний имеет формат, аналогичный <b>IER</b>.
      Вывод прерывания <b>irq</b> активен, если в <b>IFR</b> установлен хотя бы 1 бит, которому соответствует установленный в <b>IMR</b> бит.
   </p>

   <hr>
   <h3>Передача данных</h3>
   <hr>
   <p>
      <b>ehl_lssi</b> имеет буферы FIFO, доступ к которым осуществляется через виртуальный регистр <b>DR</b>.
      При записи регистра <b>DR</b> данные помещаются в очередь буфера передатчика <b>fifo_tx</b>.
	  При чтении регистра <b>DR</b> данные читаются из очереди буфера приемника <b>fifo_rx</b>.
	  Размер буферов определяется параметром <b>FIFO_SIZE</b>.
   </p>
   <p>
      При чтении из пустого буфера (<b>FSR.RxEmpty</b>=1) возвращается 0x0.
<!-- Q: RxFIFOUnderflow? -->
   </p>
   <p>
      При записи в полный буфер (<b>FSR.TxFull</b>=1) устанавливается флаг <b>FCR.TFO</b>, запись данных при этом не будет осуществляться.
   </p>

   </body>
</html>
