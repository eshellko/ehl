<html>
   <style> pre.small {line-height: 0.5; color: #0000FF; } </style>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Arbiter</title>
   </head>
   <body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
      <h2 class="title">Руководство пользователя ehl_arbiter</h2>
      <table cellpadding="4" width="0%" border="1" cellspacing="0" rules="all">
         <colgroup><col><col></colgroup>
         <tbody>
            <tr> <td bgcolor="#C0C0C0">Версия</td>      <td>1.0</td> </tr>
            <tr> <td bgcolor="#C0C0C0">Дата</td>        <td>2017.02.08</td> </tr>
            <tr> <td bgcolor="#C0C0C0">Разработчик</td> <td>А.В. Корнюхин (kornukhin@mail.ru)</td> </tr>
         </tbody>
      </table>

      <h2 class="title">Общие сведения</h2>
      <p><b>ehl_arbiter</b> представляет собой модуль управления запросами.
         Блок имеет набор параметров, позволяющих настроить его под требования проекта.
      </p>
      <h3 class="title">Основные возможности</h3>
      <ul>
         <li>Арбитраж запросов с фиксированным или честным приоритетом.</li>
      </ul>
      <h3 class="title">Области применения</h3>
      <ul>
         <li>Арбитраж мастеров на системных шинах.</li>
      </ul>

      <h2 class="title">Интерфейс</h2>
      <p><b>ehl_arbiter</b> имеет синхронный интерфейс. Запрос <b>req</b> и окончание <b>done</b> должны устанавливаться на 1 такт синхросигнала <b>clk</b>.</p>
      <table cellpadding="4" border="1" cellspacing="0" rules="all">
         <colgroup><col><col><col><col></colgroup>
         <thead>
            <tr bgcolor="#C0C0C0">
               <th>Имя</th>
               <th>Тип</th>
               <th>Размер, бит</th>
               <th>Описание</th>
            </tr>
         </thead>
         <tbody>
            <tr> <td>clk</td>              <td>Вход</td>  <td>1</td>            <td>Синхросигнал. Все триггеры в блоке тактируются нарастающим фронтом.</td> </tr>
            <tr> <td>reset_n</td>          <td>Вход</td>  <td>1</td>            <td>Асинхронный сигнал сброса. Активный уровень 0.</td> </tr>
            <tr> <td>req</td>              <td>Вход</td>  <td><b>WIDTH</b></td> <td>Входная шина запросов.</td> </tr>
            <tr> <td>done</td>             <td>Вход</td>  <td><b>WIDTH</b></td> <td>Входная шина окончания запроса.</td> </tr>
            <tr> <td>ack</td>              <td>Выход</td> <td><b>WIDTH</b></td> <td>Выходная шина подтверждений. Указывает запрос, получивший подтверждение.</td> </tr>
            <tr> <td>grant</td>            <td>Выход</td> <td><b>WIDTH</b></td> <td>Выходная шина подтверждений. Указывает запрос, получающий следующее подтверждение.</td> </tr>
            <tr> <td>arbitration_type</td> <td>Вход</td>  <td>1</td>            <td>Управление типом арбитража:<li>0 — честный;</li><li>1 — фиксированный приоритет (младший бит <b>req</b> имеет высший приоритет).</li></td> </tr>
            <tr> <td>empty</td>            <td>Выход</td> <td>1</td>            <td>Признак отсутствия активных обрабатываемых запросов.</td> </tr>
         </tbody>
      </table>

      <h2 class="title">Параметры</h2>
      <p><b>ehl_arbiter</b> может быть настроен под задачу пользователя. </p>
      <table cellpadding="4" border="1" cellspacing="0" rules="all">
         <colgroup><col><col><col><col></colgroup>
         <thead>
            <tr bgcolor="#C0C0C0">
               <th>Имя</th>
               <th>Размер, бит</th>
               <th>Значение по умолчанию</th>
               <th>Описание</th>
            </tr>
         </thead>
         <tbody>
            <tr> <td>WIDTH</td>      <td>32</td> <td>4</td> <td>Количество обрабатываемых запросов.</td> </tr>
            <tr> <td>SECOND_REQ</td> <td>1</td>  <td>1</td>
               <td>
                  Поведение блока при обработке нескольких одновременных запросов.
                  <table cellpadding="4" border="1" cellspacing="0" rules="all">
                     <colgroup><col><col></colgroup>
                     <thead>
                        <tr bgcolor="#C0C0C0">
                           <th>SECOND_REQ = 0</th>
                           <th>SECOND_REQ = 1</th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr>
                           <td>Следующий запрос выбирается на основании предыдущего <b>с понижением приоритета</b> последнего подтвержденного запроса.</td>
                           <td>Следующий запрос выбирается на основании предыдущего <b>без понижения приоритета</b> последнего подтвержденного запроса.</td>
                        </tr>
                        <tr>
                           <td>Непрерывный поток запросов <b>прерывается</b> при поступлении запроса по другому каналу</td>
                           <td>Непрерывный поток запросов <b>не прерывается</b> при поступлении запроса по другому каналу.</td>
                        </tr>
                     </tbody>
                  </table>
               </td>
            </tr>
         </tbody>
      </table>
      <p>Параметр <b>WIDTH</b> может принимать значения более 1. Максимальное значение не ограничивается RTL, но определяется требованиями к тактовой частоте и площади блока. Каскадирование арбитров меньшей ширины может давать лучший результат при увеличении Latency.</p>

      <ul>
         <pre class="small"> <b>Выбор следующего активного запроса</b></pre>
         <pre class="small">                 __    __    __    __    __    __    __    __  </pre>
         <pre class="small">  clk      _____|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |_</pre>
         <pre class="small">                    _____                   _____              </pre>
         <pre class="small">  req[0]   ________|     |_________________|     |_____________</pre>
         <pre class="small">                                            _____              </pre>
         <pre class="small">  req[1]   ________________________________|     |_____________</pre>

         <pre class="small">             *** <b>SECOND_REQ = 1</b></pre>
         <pre class="small">                       _______                  ______         </pre>
         <pre class="small">  ack[0]   ___________|    ...|________________|   ...|________</pre>
         <pre class="small">                                                       ________</pre>
         <pre class="small">  ack[1]   ___________________________________________|    ... </pre>

         <pre class="small">             *** <b>SECOND_REQ = 0</b></pre>
         <pre class="small">                       _______                         ________</pre>
         <pre class="small">  ack[0]   ___________|    ...|_______________________|    ... </pre>
         <pre class="small">                                                ______         </pre>
         <pre class="small">  ack[1]   ____________________________________|   ...|________</pre>
      </ul>

      <p>При подаче непрерывных запросов для <b>SECOND_REQ</b> = 0 следует иметь в виду, что поскольку <b>ack[0]</b> отсутсвует на 1 такт, то и поток запросов <b>req[0]</b> перестает быть непрерывным.</p>
      <ul>
         <pre class="small"> <b>Обработка непрерывных запросов</b></pre>
         <pre class="small">                 __    __    __    __    __    __    __    __  </pre>
         <pre class="small">  clk      _____|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |_</pre>
         <pre class="small">                                _____                          </pre>
         <pre class="small">  req[1]   ____________________|     |_________________________</pre>

         <pre class="small">             *** <b>SECOND_REQ = 1</b></pre>
         <pre class="small">                    _____________________________              </pre>
         <pre class="small">  req[0]   ________|                             |_____________</pre>
         <pre class="small">                       ______________________________          </pre>
         <pre class="small">  ack[0]   ___________|                              |_________</pre>
         <pre class="small">                                                      _________</pre>
         <pre class="small">  ack[1]   __________________________________________|    ...  </pre>

         <pre class="small">             *** <b>SECOND_REQ = 0</b></pre>
         <pre class="small">                    _________________       ___________        </pre>
         <pre class="small">  req[0]   ________|                 |_____|           |_______</pre>
         <pre class="small">                       ___________        ________________     </pre>
         <pre class="small">  ack[0]   ___________|           |______|                |____</pre>
         <pre class="small">                                   ______                      </pre>
         <pre class="small">  ack[1]   _______________________|      |_____________________</pre>
      </ul>

      <h2 class="title">Функционирование</h2>
      <p>Установка <b>req</b> и окончание запросов <b>done</b> должны устанавливаться в формате однотактных импульсов.</p>
      <p>Для получения подтверждения следует установить <b>req</b> на 1 такт <b>clk</b>. Если в данный момент ни один из выходов <b>ack</b> не установлен, арбитр дает подтверждение для запроса (установкой <b>grant</b>). В противном случае запрос помещается в общую очередь и будет обработан в соответствии с правилами арбитража в момент окончания текущего подтверждения. Окончание подтверждения требует установки соответствующего сигнала <b>done</b> на 1 такт <b>clk</b>.</p>

      <ul>
         <pre class="small">              __    __    __    __    __    __    __  </pre>
         <pre class="small">  clk      __|  |__|  |__|  |__|  |__|  |__|  |__|  |_</pre>
         <pre class="small">                      _____                           </pre>
         <pre class="small">  req      __________|     |__________________________</pre>
         <pre class="small">                        _____                         </pre>
         <pre class="small">  grant    ____________|     |________________________</pre>
         <pre class="small">                           _________________          </pre>
         <pre class="small">  ack      _______________|                 |_________</pre>
         <pre class="small">                                         _____        </pre>
         <pre class="small">  done     _____________________________|     |_______</pre>
      </ul>

      <p>Не допускается устанавливать <b>req</b>, если предыдущий запрос не был обработан (подтвержден или находится в очереди). Не допускается заканчивать запрос (установкой <b>done</b>), который не был подтвержден.</p>

      <p>В схеме с фиксированным арбитражем, подтверждение получает тот запрос, который имеет меньший индекс. В схеме с честным арбитражем, подтверждение получает запрос, имеющий следующий индекс после предыдущего подтвержденного. За исключением случая арбитража между двумя индексами, один из которых имеет значение последнего подтвержденного. В этом случае сначала подтвердится последний подтвержденный (но не  более одного раза при прерывистых запросах), а затем следующий.</p>
<!--
      <ul>
         <pre class="small">              __    __    __    __    __    __    __    __    __    __    __  </pre>
         <pre class="small">  clk      __|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |_</pre>
         <pre class="small">                      _____        _____                   _____              </pre>
         <pre class="small">  req[0]   __________|     |______|     |_________________|     |_____________</pre>
         <pre class="small">                                   _____                                      </pre>
         <pre class="small">  req[1]   _______________________|     |_____________________________________</pre>
         <pre class="small">                        _____        _____                         _____      </pre>
         <pre class="small">  grant[0] ____________|     |______|     |_______________________|     |_____</pre>
         <pre class="small">                                                             _____            </pre>
         <pre class="small">  grant[1] _________________________________________________|     |___________</pre>
         <pre class="small">                           _____       _________________             _________</pre>
         <pre class="small">  ack[0]   _______________|     |_____|                 |___________|         </pre>
         <pre class="small">                                                         ___________          </pre>
         <pre class="small">  ack[1]   _____________________________________________|           |_________</pre>
         <pre class="small">                               _____                  _____                   </pre>
         <pre class="small">  done[0]  ___________________|     |________________|     |__________________</pre>
         <pre class="small">                                                                   _____      </pre>
         <pre class="small">  done[1]  _______________________________________________________|     |_____</pre>
      </ul>
-->
   </body>
</html>
